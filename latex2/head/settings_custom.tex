% Author :  Lionel du Peloux
% Contact : lionel.dupeloux@gmail
% Year : 2017
% !TEX encoding = UTF-8 Unicode

\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{bm}
\usepackage{mathtools}
\usepackage{stmaryrd}
\usepackage{lipsum}
%\usepackage{MnSymbol} %=> conflict with \varkappa from amssymb
%\usepackage{minted}
\usepackage{pdflscape}
\usepackage{tikz}
\usetikzlibrary{external}
%\tikzexternalize[prefix=tikz/]
\usepackage{pgfplots,pgfplotstable}
\usepackage{siunitx}
\usepackage[nameinlink, noabbrev]{cleveref} % attention a loader apres hypperef (use nameinlink or noabbrev options)
\usepackage{csvsimple, booktabs, longtable} % pour les tables CSV

\usepackage{float}
\usepackage{csquotes}
\usepackage{epigraph} % incompatible avec nextpage
\usepackage{dpfloat} % for double page float figures aand tables side by side
\usepackage{afterpage} % for double page float figures aand tables side by side
%\usepackage{nextpage} % incompatible avec epigraph. 
\usepackage{textcomp} % € symbol
%\usepackage{fnpct} % for multiple footnotes
% \usepackage{etoc}

\usepackage{etoolbox} % if then else in macro
\usepackage{bookmark} % manipulate bookmark level


% deactivate flushbottom
\frenchspacing
\raggedbottom

% DATE TIME
% ===========================
\usepackage{datetime}
\addto\captionsenglish{% Replace "english" with the language you use
  \renewcommand{\contentsname}%
    {Table of Content}%
}

% METADATA
% ===========================
% http://www.mathstat.dal.ca/~selinger/pdfa/
% https://tex.stackexchange.com/questions/139308/how-to-embed-abstract-as-an-xmp-metadata
% SPEC SUBLIN : http://dublincore.org/documents/dces/
% https://tex.stackexchange.com/questions/139716/is-it-possible-to-use-both-hyperxmp-and-xmpincl-in-latex
\newcommand\mytitle{Modeling of bending-torsion couplings in active-bending structures. Application to the design of elastic gridshell.}
\newcommand\myauthor{Lionel du Peloux de Saint Romain}
\newcommand\mykeywords{gridshell, active bending, freeform, dynamic relaxation}
\newcommand\myabstract{My abstract.}

% to be used with pdfx
%\usepackage{filecontents}
%\begin{filecontents*}{\jobname.xmpdata}
%	\Doi{12345}
%\end{filecontents*}

%% have a look at : https://tex.stackexchange.com/questions/139308/how-to-embed-abstract-as-an-xmp-metadata
% DOI : https://github.com/semprag/tex/blob/master/sp.cls
\hypersetup{%
pdftype={thesis},
pdftitle={\mytitle},
pdfauthor={\myauthor},
pdfproducer={\myauthor},
pdfauthortitle={Technical Assistant, Level III},
pdfdate={\the\year-\the\month-\the\day},
pdfcopyright={Copyright (C) \the\year, \myauthor},
pdfsubject={elastic gridshells},
pdfkeywords={\mykeywords},
pdflicenseurl={http://creativecommons.org/licenses/by-nc-nd/3.0/},
pdfcaptionwriter={Scott Pakin},
pdfcontactaddress={Kramgasse 49},
pdfcontactcity={Paris},
pdfcontactpostcode={75},
pdfcontactcountry={France},
pdfcontactphone={},
pdfcontactemail={lionel.dupeloux@gmail.com},
pdfcontacturl={%
http://www.thinkshell.fr,
https://www.facebook.com/AlbertEinstein
},
pdflang={en},
pdfmetalang={en},
baseurl={http://www.thinkshell.fr}
}

% TODO
% ===========================
\usepackage{todonotes}

% BMATRIX
% ===========================
\usepackage{mathtools} % bmatrix right align

% BIBLATEX
% ===========================
\usepackage[
backend=biber, 
natbib=true, % provide alias to natbib command
%style=numeric, 
bibstyle=ieee,%ieee,
citestyle=numeric,
%sortcites=true, 
sorting=none,
doi=false, isbn=false, url=false,
mincitenames=1,
maxcitenames=2, maxbibnames=100,
firstinits=true, % firstinits old option
refsegment=chapter, % defernumbers=true, % attention cette option semble faire buger l'ordre des citations dans la biblio
useprefix=true, % use von as part of the family name (du peloux)
]{biblatex} 
\addbibresource{library.bib}
\defbibheading{subbibliography}[\refname]{\section{#1}}
\renewcommand*{\multicitedelim}{\addcomma\space}
\newcommand{\citef}[2][]{\citeauthor{#2} \citeyear{#2} \cite[#1]{#2}} % custom full cite

% No quotes or italics in titles, except books and collections in italics.
%\DeclareFieldFormat[article,inbook,incollection,inproceedings,patent,thesis,unpublished]{title}{#1\isdot}
%\DeclareFieldFormat[book,collection]{title}{\emph{#1}}
\renewcommand*{\multinamedelim}{\addcomma\addspace} % separator mark between authors
\renewcommand*{\finalnamedelim}{\addspace and \addspace} % separator mark between authors
\renewcommand{\labelnamepunct}{\addcomma\addspace}

\renewbibmacro*{in:}{%
    \ifentrytype{article}{}{\printtext{\bibstring{in}\intitlepunct}}}

% Remove page prefixes in article
\DeclareFieldFormat[article]{pages}{#1}
% Print volume, followed by number in parentheses.
\DeclareFieldFormat[article]{number}{\mkbibparens{#1}}
\renewbibmacro*{volume+number+eid}{%
	\printfield{volume}%
    	\printfield{number}}

% Colon for volume(number):pages delimiter.
\renewcommand*{\bibpagespunct}{%
	\ifentrytype{article}{\addcolon}{\addcomma\space}}

% with this macro you can chose to link the citation labels to local subbib (anchorsegments=true) or to global bib (anchorsegments=false)
% local links does not work if chapter has no subbib, because there is not subib to point to !
% https://tex.stackexchange.com/questions/142632/multiple-bibliographies-with-local-links-global-labels-also-global-bibliograph/142720
\newbool{anchorsegments}\boolfalse{anchorsegments}
\makeatletter
\AtBeginDocument{%
  \ifbool{anchorsegments}
    {\long\def\blx@bibhyperref[#1]#2{%
       \blx@sfsave\hyper@natlinkstart{\the\c@refsection @\the\c@refsegment @#1}%
       \blx@sfrest
       #2%
       \blx@sfsave\hyper@natlinkend\blx@sfrest}%
     \protected\long\def\blx@imc@bibhyperlink#1#2{%
       \blx@sfsave\hyper@natlinkstart{\the\c@refsection:\the\c@refsegment:#1}%
       \blx@sfrest
       #2%
       \blx@sfsave\hyper@natlinkend\blx@sfrest}%
     \protected\long\def\blx@imc@bibhypertarget#1#2{%
       \blx@sfsave\hyper@natanchorstart{\the\c@refsection:\the\c@refsegment:#1}%
       \blx@sfrest
       #2%
       \blx@sfsave\hyper@natanchorend\blx@sfrest}%
     \protected\def\blx@anchor{%
       \xifinlist
         {\the\c@refsection @\the\c@refsegment @\abx@field@entrykey}
         {\blx@anchors}
         {}
         {\listxadd
            {\blx@anchors}
            {\the\c@refsection @\the\c@refsegment @\abx@field@entrykey}%
          \hyper@natanchorstart{%
            \the\c@refsection @\the\c@refsegment @\abx@field@entrykey}%
          \hyper@natanchorend}}%
     \defbibheading{subbibliography}{\section{\refname}}}
    {\defbibheading{subbibliography}{%
       \AtNextBibliography{\let\blx@anchor\relax}%
       \section{\refname}}}}
\makeatother
\defbibheading{subbibliography}[\refname]{\chapter*{\bibname}}

% STYLES
% ===========================
\input{head/settings_styles.tex}
\input{head/settings_functions.tex}

% TOC
% ===========================
\setcounter{tocdepth}{2}
\usepackage[]{tocbibind}

% LIST OF FIGURES
% ===========================
\setcounter{lofdepth}{2}

% LIST OF TABLES
% ===========================
\setcounter{lotdepth}{2}


% CAPTION
% ===========================
\usepackage[font=small,textfont={normalfont},labelfont={bf,tt}]{caption}
\captionsetup[table]{skip=10pt}
\captionsetup[figure]{skip=10pt}
\captionsetup[subfloat]{captionskip=10pt}

% CREF
% ===========================
\crefformat{section}{§#2#1#3}
\Crefname{figure}{Fig/}{Figs.}
\crefname{figure}{fig.}{figs.}
\Crefname{figure}{Fig/}{Figs.}
\crefname{table}{tab.}{tabs.}
\Crefname{table}{Tab.}{Tabs.}
\crefname{equation}{eq.}{eqs.}
\Crefname{equation}{Eq.}{Eqs.}

% PLOTS
% ===========================
\usepgfplotslibrary{fillbetween}
\usetikzlibrary{patterns}
\pgfplotsset{width=10cm, compat=1.14}
\pgfplotsset{grid style = { line cap = round, Tgray, line width = 0.25pt}}

% TABLE
% ===========================
\usepackage{tabularx}
\usepackage{multirow}
\newcolumntype{Y}{>{\centering\arraybackslash}X}
\newcolumntype{Z}{>{\raggedright\arraybackslash}X}

% l r c coumns width optional fixed with
\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}

\usepackage{booktabs}
\newcommand{\ra}[1]{\renewcommand{\arraystretch}{#1}}
\newcommand{\tablebf}{\fontseries{b}\selectfont} % bold font that does not get wider to keep bold numbers aligned

% ACRONYM
% ===========================
\newcommand{\rhino}{\emph{Rhinoceros}}
\newcommand{\grasshopper}{\emph{Grasshopper}}

\newcommand{\dofs}[1]{%
	\ifstrempty{#1}{DOFs}{%
		\ifnumequal{#1}{1}{1\,-DOF}{%
			#1\,-DOFs%
		}%
	}%
}

\newcommand{\dt}{h} % timestep


% ALGORITHM
% ===========================
\usepackage[linesnumbered,lined,ruled,commentsnumbered]{algorithm2e}


% LDP Theorem
%--------------------------------------
\newtheoremstyle{mystyleA} % style name
    {}              % space above, empty = `usual value'
    {20pt}          % space below
    {}              % body font
    {}              % indent
    {\bfseries}     % head font
    {.}             % punctuation after head
    {5pt}           % space after head (\newline)
    {}              % Thm head spec

\theoremstyle{mystyleA}
\newtheorem*{mydef}{Definition}
\newtheorem*{myrk}{Remark}

\newtheoremstyle{mystyleB} % style name
    {}              % space above, empty = `usual value'
    {20pt}          % space below
    {\itshape}      % body font
    {}              % indent"
    {\itshape}      % head font
    {.}             % punctuation after head
    {5pt}           % space after head (\newline)
    {}              % Thm head spec
\theoremstyle{mystyleB}
\newtheorem*{myproof}{Preuve}




% LDP Custom functions
%--------------------------------------




% typo
\newcommand{\telp}{\textellipsis{}}
\newcommand{\belp}{\textelp{}} % bracket elipsis
\newcommand{\guil}[1]{\og#1\fg{}}
\newcommand{\note}[1]{\color{blue}#1\color{black}}

% fonction inline (SHORT)
\newcommand{\fonction}[3]{#1 : #2 \longmapsto #3}

% fonction 2 lines (LONG)
\newcommand{\fonctionL}[5]{\begin{array}{lrcl}
#1: & #2 & \longrightarrow & #3 \\
    & #4 & \longmapsto & #5 \end{array}}

% differential
\newcommand{\diff}[2]{\boldsymbol{D}#1(#2)}
\newcommand{\diffN}[3]{\boldsymbol{D}^#1#2(#3)}
\newcommand{\diffof}[3]{\boldsymbol{D}#1(#2)\cdot#3}
\newcommand{\diffNof}[4]{\boldsymbol{D}^#1#2(#3)\cdot#4}

% partial differential
\newcommand{\pdiff}[3]{\boldsymbol{D}_#1#2(#3)}
\newcommand{\pdiffN}[4]{\boldsymbol{D}^#1_#2#3(#4)}
\newcommand{\pdiffof}[4]{\boldsymbol{D}_#1#2(#3)\cdot#4}
\newcommand{\pdiffNof}[5]{\boldsymbol{D}^#1_#2#3(#4)\cdot#5}

% vector, matrix and tensor
\newcommand{\vect}[1]{\boldsymbol{#1}} 
\newcommand{\mat}[1]{\boldsymbol{\mathit{#1}}}
\newcommand{\tens}[1]{\boldsymbol{\mathcal{#1}}}

\newcommand{\scalar}[2]{\langle #1\,, #2\rangle}

\newcommand{\grad}[1]{grad\;#1}
\DeclarePairedDelimiter\abs{\lvert}{\rvert}
\DeclarePairedDelimiter\norm{\lVert}{\rVert}

\newcommand{\Tr}[1]{Tr(#1)} %trace operator

\newcommand{\para}{{\mkern3mu\vphantom{\perp}\vrule depth 0pt\mkern2mu\vrule depth 0pt\mkern3mu}} % reduced heigth parallel symbol

\newcommand*\circled[1]{\tikz[baseline=(char.base)]{
    \node[shape=circle,draw,inner sep=2pt] (char) {#1};}}
 
% Footnotes
% ---------------------------------
 \makeatletter
%%\def\footnoterule{\kern-8\p@
%%  \hrule \@width 2in \kern 7.6\p@} % the \hrule is .4pt high
\def\footnoterule{\kern-3\p@
  \hrule \@width 2in \kern 2.6\p@} % the \hrule is .4pt high
\makeatother
\setlength{\skip\footins}{5mm}
% nomenclature of symbols
% ---------------------------------
\usepackage[intoc]{nomencl}
\makenomenclature
\renewcommand{\nomname}{Index of notation}
\usepackage{etoolbox}
\renewcommand\nomgroup[1]{%
  \item[\bfseries
  \ifstrequal{#1}{A}{\texttt{Geometry of curves}}{%
  \ifstrequal{#1}{B}{\texttt{Mechanics of rods}}{%
  \ifstrequal{#1}{C}{\texttt{Other Symbols}}{}}}%
]\vspace{12pt}}
%\renewcommand{\nomgroup}[1]{\medskip}

% 
%% index of notation entry
%\usepackage[]{glossaries}
%\newglossary[ntg]{notation}{not}{ntn}{Glossaire}
%%\newglossary[slg]{symbols}{sym}{sbl}{Nomenclature}
%\makeindex
%\makeglossaries
%
%\newacronym{tem}{TEM}{Transmission Electron Microscope}
%\newacronym{sem}{SEM}{Scanning Electron Microscope}
%
%\newglossaryentry{real number}
%{
%  name={real number},
%  description={include both rational numbers, such as $42$ and 
%               $\frac{-23}{129}$, and irrational numbers, 
%               such as $\pi$ and the square root of two; or,
%               a real number can be given by an infinite decimal
%               representation, such as $2.4871773339\ldots$ where
%               the digits continue in some way; or, the real
%               numbers may be thought of as points on an infinitely
%               long number line},
%  symbol={\ensuremath{\mathbb{R}}}
%}
%
%
%\newglossaryentry{mesh}{
%	type=notation,
%    	name={Mesh},
%    	description={maillage},
%    	sort={m}
%}

% overbar & hat
% -----------------------------------

% old version (renamed bellow)
%\newcommand{\overbar}[1]{\mkern 1.5mu\overline{\mkern-1.5mu#1\mkern-1.5mu}\mkern 1.5mu}


\usepackage{scalerel,stackengine}
\stackMath
\usepackage{verbatimbox} % For \addvbuffer
\usepackage{xparse}
\newlength\glyphwidth
\newlength\widthofx

% over hat

\newsavebox\hatglyphCONTENT
\sbox\hatglyphCONTENT{%
	%% 1ST OPTIONAL ARGUMENT OF \addvbuffer (CROP OFF TOP OF STACKED hat)
	%%	2ND OPTIONAL ARGUMENT OF \addvbuffer (CROP OFF BOTTOM OF STACKED hat)
    	\addvbuffer[-0.05ex -1.1ex]{$\hat{\phantom{.}}$}%
}

%% The floating point parameter scales the hatt glyphs everywhere.
\newcommand\hatglyph{\resizebox{0.6\widthofx}{!}{\usebox{\hatglyphCONTENT}}}
\newcommand\shifthat[2]{%
	%% 1ST ARGUMENT OF \stackengine (GAP BETWEEN GLYPH AND \hatglyph)
    \stackengine{0.2\widthofx}{%
        \SavedStyle#2}{%
        \rule{#1}{0ex}\hatglyph}{O}{c}{F}{T}{S}%
}
\ExplSyntaxOn
\newcommand\relativeGlyphOffset[1]{%
    	% The horizontal offset in arbitrary units that scale with math style.
    \str_case:nnF{#1}{%
        {A}{0.18}%
        {B}{0.1}%
        {W}{0.02}%
        {J}{0.18}%
        {\phi}{0.17}%
        {\varkappa}{0.12}%
        {\vect{\varkappa}}{0.13}% 
        {\vect{\omega}}{0.03}%
        {\mathcal{S}}{0.1}%  
    }{0.05}% Default
}\ExplSyntaxOff
% \hatt{decoratedLetter}[A] will insert the decoratedLetter with the hat
% above it, horizontally adjusted as if the decoratedLetter was an "A".
% If the trailing optional argument is not provided, then it defaults 
% to the decoratedLetter. This way we could do e.g. \hatt{\hatt{A}}[A].
\NewDocumentCommand{\hatt}{mO{#1}}{%
    \ThisStyle{%
        \setlength\glyphwidth{\widthof{$\SavedStyle{}\longleftarrow$}}%
        \setlength\widthofx{\widthof{$\SavedStyle{}x$}}%
        \shifthat{\relativeGlyphOffset{#2}\glyphwidth}{#1}%
  }%
}

% over bar

\newsavebox\barglyphCONTENT
\sbox\barglyphCONTENT{%
	%% 1ST OPTIONAL ARGUMENT OF \addvbuffer (CROP OFF TOP OF STACKED bar)
	%%	2ND OPTIONAL ARGUMENT OF \addvbuffer (CROP OFF BOTTOM OF STACKED bar)
    \addvbuffer[-0.05ex -1.35ex]{$\bar{\phantom{.}}$}%
}

%%%% The floating point parameter scales the check glyphs everywhere.
\newcommand\barglyph{\resizebox{0.7\widthofx}{!}{\usebox{\barglyphCONTENT}}}
\newcommand\shiftbar[2]{%
%%%% 1ST ARGUMENT OF \stackengine (GAP BETWEEN GLYPH AND \checkglyph)
    \stackengine{0.2\widthofx}{%
        \SavedStyle#2}{%
        \rule{#1}{0ex}\barglyph}{O}{c}{F}{T}{S}%
}

\NewDocumentCommand{\barr}{mO{#1}}{%
    \ThisStyle{%
        \setlength\glyphwidth{\widthof{$\SavedStyle{}\longleftarrow$}}%
        \setlength\widthofx{\widthof{$\SavedStyle{}x$}}%
        \shiftbar{\relativeGlyphOffset{#2}\glyphwidth}{#1}%
    }%
}

\newcommand{\rconf}[1]{\barr{#1}}
\newcommand{\overbar}[1]{\barr{#1}}
\newcommand{\overhat}[1]{\hatt{#1}}

% LDP Julia
%--------------------------------------

\usepackage{framed}

\definecolor{shadecolor}{gray}{.92}
\definecolor{incolor}{rgb}{0,0,.7}
\definecolor{outcolor}{rgb}{.65,0,0}
\definecolor{syntaxcolor}{rgb}{.65,0,0}
\usepackage{verbatim}
\newcommand{\sh}[1]{\textcolor{syntaxcolor}{#1}}

\newcounter{jcounter}
\newenvironment{jinput}[1][]{\ifx#1\relax\else\setcounter{jcounter}{#1}\addtocounter{jcounter}{-1}\fi\refstepcounter{jcounter}\ttfamily\hspace*{-.7in}\noindent\begin{minipage}[t]{.19\textwidth}\vskip2ex\hspace*{\fill}\textcolor{incolor}{In[\arabic{jcounter}]: }\end{minipage}\begin{minipage}[t]{.8\textwidth}\vskip-0ex\begin{shaded}}{\end{shaded}\end{minipage}\par}

\newenvironment{joutput}[1][]{\vskip1ex plus .2ex minus .1ex\ifx#1\relax\else\setcounter{jcounter}{#1}\fi\addtocounter{jcounter}{-1}\refstepcounter{jcounter}\ttfamily\noindent\hspace*{-.2in}\begin{minipage}[t]{.19\textwidth}\vskip0ex\hspace*{\fill}\textcolor{outcolor}{Out[\arabic{jcounter}]: }\end{minipage}\begin{minipage}[t]{.8\textwidth}\vskip-0ex}{\end{minipage}\par\vskip1.5ex}

     \newcommand{\ja}{\begin{jinput}}
     \newcommand{\jb}{\end{jinput}\begin{joutput}}
     \newcommand{\jc}{\end{joutput}}

    \newcommand{\jav}{\begin{jinput}\begin{verbatim}}
     \newcommand{\jbv}{\end{verbatim}\end{jinput}\begin{joutput}\begin{verbatim}}
     \newcommand{\jcv}{\end{verbatim} \end{joutput}}

\usepackage{fancyvrb}


%% HYP REF LINK IN PDF ( attention, doit être chargé en dernier sinon bug dans les liens footnote)
%\usepackage{hyperxmp} % pdf metadada (LDP)
%%%\usepackage[a-1b]{pdfx}
%\usepackage{hyperref} % pdf metadada (LDP)
%\hypersetup{pdfborder={0 0 0},
%	colorlinks=true,
%	linktoc=page,
%	linkcolor=Tblue,
%	citecolor=Tblue,
%	urlcolor=Tblue} 
%\urlstyle{same}

