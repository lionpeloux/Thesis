% Author :  Lionel du Peloux
% Contact : lionel.dupeloux@gmail
% Year : 2017
% !TEX encoding = UTF-8 Unicode

\chapter{Numerical Model} \label{chp:numerical_model}

\section{Introduction}

Penser à expliquer le dualisme edge / vertex. En pratique, on a envie de contrôler le model par les noeuds et les propriétés sur les bords. Ce que peu de models savent faire. C'est aussi mieux pour les conditions de bords. C'est le vrai avantage de ce modèle.

Expliquer l'interpolation des efforts. Il y a un choix a faire dans la DR. Soit on écrit l'équilibre sur le noeud (de dimension null). Soir on écrit l'équilibre sur une tranche de dimension $l_i+l{i+1}/2$. Mais si l'on veut maintenir la précision des conditions de passage, la DR fonctionne avec des noeuds et pas des tranches, le mieux est d'opter pour un équilibre du noeud. La DR va minimiser les résidus aux noeuds et donc on aura les bonnes conditions de passage sous Fext et Mext. J'ai montré que la convergence était plus rapide et précise. On a pas de décalage dans les diagrammes des efforts (si il y en a, ce sont uniquement les défauts de convergence, le résidu , n'étant pas strictement nul au noeud à la fin de la DR).

\subsection{Overview}

\subsection{Contributions}
\begin{itemize}
	\item We use the parallel transport in time and not in space.
	\item we clarify the edge-vertex representation in a natural manner (material properties to the edges, the rest to the vertices)
	\item We give interpolation of internal forces and moments across the path
	\item We propose a new discrete element with 3 nodes (2H + 1G)
	\item We take account for discontinuities a Handle vertices (curvature, discontinuities)
\end{itemize}

\subsection{Related works}

\citef{Miki2014}~: DR as a gradient descent method

Départ~:
\citef{Day1965}~: already includes a rotational DOF !!
\citef{Wakefield1980}
\citef{Barnes1999}~: revue intéressante de la DR.

3 pts classique~:
\citef{Adriaenssens1999}
\citef{Douthe2006}

2 x 3pts~:
\citef{Barnes2013}

6 Dofs~:
\citef{DAmico2014}

4Dofs~:
\citef{DuPeloux2015}
\citef{DAmico2016}

Dans le champ de l'animation  avec élément finis
\citef{Duan2013}
\citef{Meier2014}

Pour des cas test :
\citef{Ibrahimbegovic1995}
\citef{Lazaro2016}

\citef{Dang2010}
\citef{Rezaiee2012}


\clearpage
\section{Main hypothesis}

On néglige les forces d'inertie liées à la rotation de l'élément  (devant quoi ?? traitement quasi-statique par rapport à la rotation). Cette hypothèse est faite explicitement chez Florence Bertail~:



Cette hypothèse est faite mais passée sous silence chez Douthe, Adriaenssen, D'Amico lorsqu'ils déduisent l'effort tranchant du moment de flexion.

Principe~:

- les équations constitutives permettent le calcul de $M_1$, $M_2$, $Q$ à partir de la géométrie $\{\vect{x},\theta\}$.

- La seconde loi de kirchhoff projetée sur les axes matériels 1 et 2 de la section me donnent accès aux efforts tranchants $T_1$ et $T_2$.

- La seconde loi de kirchhoff projetée sur les axes matériel 3 (tangente à la centerline) de la section me donnent l"hypothèse quasi-statique de Audoly.

%\begin{figure}[t]
%	\centering
%	\includegraphics[]{discrete_model.pdf}
%	\caption{Biarc model for a discrete beam. The centerline is divided into curved segments (grey solid hatch). Each segment is defined as a 3-noded element with uniform material and section properties. It has two end vertices (white) called \emph{handle} as they are used to interact with the model, for instance to apply loads or restrains. It has one mid vertex (grey) called \emph{ghost} as it is used only to enrich the segment kinematics and is not accessible to the end user.}
%	\label{fig:discrete_model}
%\end{figure} 


\section{Discret beam model}\label{sec:dmodel}
% =======================
Let's introduce the discrete biarc model to describe the configuration of a beam. It is composed of a discrete curve called \emph{centerline} ($\Gamma$) and a discrete adapted frame called \emph{material frame} as its axes are chosen to be the principal axes of the beam cross-section (\cref{fig:discrete_model}). The centerline itself is organized in $n_s$ consecutive adjacent segments which are three-vertices and two-edges elements with uniform material and section properties.

Beams can either be closed or open. The corresponding number of vertices, edges and segments are reported in \cref{tab:count}.
\begin{figure}[p]
\begin{fullpage}
	\captionsetup[subfloat]{captionskip=20pt}
     	\centering
     	\subfloat[][Centerline of the discrete biarc model.]{\includegraphics{discrete_model.pdf}\label{fig:discrete_model}} \\
	\vspace{30pt}
	\subfloat[][Number of segments, edges and vertices whether the centerline is closed or open.]{
		 \ra{1.2}
		 \begin{tabularx}{0.45\textwidth}{@{} X l r  r@{}}
		 \toprule
		 		&			& \multicolumn{2}{c}{Centerline} \\ \cmidrule(l){3-4}
		 Item 	&  Symbol 	& Open 	& Closed \\
		 \midrule
		segments & $n_s$ & $n_s$ & $n_s$ \\
		edges & $n_e$ & $2 n_s$ & $2 n_s$ \\
		vertices & $n$ & $2 n_s + 1$ & $2 n_s$ \\
		ghosts & $n_g$ & $n_s$ & $n_s$ \\
		handles & $n_h$ & $n_s+1$ & $n_s$ \\
		\bottomrule
	\end{tabularx}
	\label{tab:count}}
	\vspace{10pt}
	\captionof{figure}[Biarc model for a discrete beam element]{Biarc model for a discrete beam element. The centerline is divided into curved segments (grey solid hatch). Each segment is defined as a three-noded element with uniform material and section properties. It has two end vertices (white) called \emph{handle} as they are used to interact with the model, for instance to apply loads or restrains. It has one mid vertex (grey) called \emph{ghost} as it is used only to enrich the segment kinematics and is not accessible to the end user.}
\end{fullpage}
\end{figure}

\subsection{Description of the motion}

\subsubsection{Centerline}
% --------------------------------
The discrete centerline is a polygonal space curve (\cref{fig:discrete_model}) defined as an ordered sequence of $n+1$ pairwise disjoint \emph{vertices}~: $\Gamma = (\vect{x}_0,  \vect{x}_1, \ldots, \vect{x}_n) \in \mathbb{R}^{3(n+1)}$. Consecutive pairs of vertices define $n$ straight segments $(\vect{e}_0,  \vect{e}_1, \ldots, \vect{e}_{n-1})$ called \emph{edges} and pointing from one vertex to the next one~: 
\begin{subequations}
	\begin{alignat}{1}
	\vect{e}_i 	&= \vect{x}_{i+1} - \vect{x}_{i}
	\\
	l_i 		&= \norm{\vect{e}_i} 
	\\
	\vect{u}_i 	&= \vect{e}_i / l_i = \vect{d}_{3, i+1/2} 
	\end{alignat}
\end{subequations}
The length of the $i$th edge is denoted $l_i $ and its normalized direction vector is denoted $\vect{u}_i$. The arc length of the $i$th vertex is denoted $s_i$ and is given by~: 
\begin{equation}
	\left\{
	\begin{aligned}
		s_0 	&= 0 				& 	&i = 0		\\
		s_i 	&= \sum_{k=0}^{i-1} l_k	&	&i \in \llbracket 1, n-1 \rrbracket	\\
		s_n 	&=  L 				&	&i = n		\\
	\end{aligned}
	\right.
\end{equation}
Thus, the centerline is parametrized by arc length and $\Gamma(s_i) = \vect{x}_i$. Additionally, we define the vertex-based mean length at vertex $\vect{x}_i$~: 
\begin{equation}
%\setlength{\jot}{8pt}
	\left\{
	\begin{aligned}
		\rconf{l}_0 	& =  \tfrac{1}{2}l_0				&		&i = 0					\\
		\rconf{l}_i	& =  \tfrac{1}{2}(l_{i-1} + l_i)		&		&i \in \llbracket 1, n-1 \rrbracket	\\
		\rconf{l}_n 	& =  \tfrac{1}{2}l_{n-1} 			&		&i = n					\\
	\end{aligned}
	\right.
\end{equation}

\subsubsection{Segments}
% ---------------------------------
The discrete centerline is divided into $n_s$ curved segments. Each segment is a three-noded element -- see \cref{fig:discrete_model} where the area covered by a segment is represented as a grey solid hatch. The $i$th segment is composed of three vertices ($\vect{x}_{2i}, \vect{x}_{2i+1},  \vect{x}_{2i+2}$) spanning two edges ($\vect{e}_{2i}, \vect{e}_{2i+1}$). The (i-1)th segment and the $i$th segment share the same vertex $\vect{x}_{2i}$ at arc length $s_{2i}$.

Each segment has two end vertices called \emph{handle} ($\vect{x}_{2i}, \vect{x}_{2i+2}$) and one mid vertex called \emph{ghost} ($\vect{x}_{2i+1}$) as this one is not accessible to the end user in order to interact with the model (link, restrain, loading, \dots). Ghost vertices are used only for internal purpose to give a higher richness in the kinematic description of a segment than a two-noded segment would.

Finally, we define the \emph{chord length} of the $i$th segment as the distance between $\vect{x}_{2i}$ and $\vect{x}_{2i+2}$~:
\begin{equation}
	L_i = \norm{\vect{e}_{2i} + \vect{e}_{2i+1}} \quad , \quad i \in \llbracket 0, n_s-1 \rrbracket
\end{equation}

\subsubsection{Material frames}
% ---------------------------------------

\subsubsection{Material and section properties}
% ------------------------------------------------------------
In addition, the model assumes that a segment has uniform section ($S$, $I_1$, $I_2$, $J$)\footnote{$S$ is the cross-section area ; $I_1$, $I_2$ and $J$ are the principal moments of inertia of the cross-section.} and material ($E$, $G$)\footnote{$E$ is the elastic modulus and $G$ is the shear  modulus for the considered material} properties over its length $s \in ]s_{2i},s_{2i+2}[$. For the sake of simplicity, we introduce for further calculations the \emph{material stiffness matrix} ($\mat{B}_i$) attached to each segment. It has the following form in the material frame basis~:
\begin{equation}
	\mat{B}_i = \begin{bmatrix} 
			EI_1		&	0		&	0		\\
			0		&	EI_{2}	&	0		\\
			0		&	0		&	GJ_{}	\\
		\end{bmatrix}_i
	\quad , \quad i \in \llbracket 0, n_s-1 \rrbracket
	\label{eq:stiffnessmatrix}
\end{equation}
where $EI_1$ and $EI_2$ are the bending stiffnesses and $GJ$ is the torsional stiffness. The axial stiffness of the $i$th segment is denoted by :
\begin{equation}
	ES_i 	\quad , \quad i \in \llbracket 0, n_s-1 \rrbracket
\end{equation}

\subsubsection{Distributed loads}
% -----------------------------------------
The model assumes that each segment can be loaded with some distributed forces ($\vect{f}^{ext} = f_k\vect{d}_k$) and moments ($\vect{m}^{ext} = m_k\vect{d}_k$). These forces and moments are required to be uniform over each segment but can vary from one segment to another. They can represent body loads such as self weight or thermal loads or external loads such as wind, snow, pressure,~\dots

\subsubsection{Concentrated loads}
% ---------------------------------------
Additional External concentrated forces ($\vect{F}^{ext}$) and moments ($\vect{M}^{ext}$) are applied to the segment's end vertices ($\vect{x}_{2i}$,  $\vect{x}_{2i+2}$). Note that the model does not allow to load ghost vertices, and this is precisely why they are called \textquote{ghost}.

 \subsubsection{Internal forces and moments}
% ---------------------------------------------------------
Under deformations the discrete rod is subject to internal forces and moments. Their components in the material frame basis are named as follow :
\begin{itemize}
\item The shear force : $\vect{F}^{\perp} = F_1 \vect{d}_1 + F_2 \vect{d}_2$ 
\item The axial force : $\vect{N} = N \vect{d}_3$
\item The bending moment : $\vect{M}^{\perp} = M_1 \vect{d}_1 + M_2 \vect{d}_2$ 
\item The twisting moment : $\vect{Q} = Q \vect{d}_3$ 
\end{itemize}

% Modeling discontinuities
% ------------------------------------
 \subsection{Modeling discontinuities}
The model assumes that cross-section and material properties as well as distributed loads are uniform over each segment. Referring to the structure of the equations of motion, and because the centerline is required to be a regular curve in the stress-free configuration, strains, stresses, displacements, internal forces and internal moments must be piecewise continuous functions of the arc length parameter, continuous over each segment $]s_{2i},s_{2i+2}[$. Discontinuities of these functions might occur at handle vertices ($\vect{x}_{2i}$), for instance if there is a jump in material or cross-section properties or if concentrated loads are applied at handle vertices. Moreover, the centerline curve itself will stay $\mathcal{C}^1$ during the motion, as it is chosen to be $\mathcal{C}^1$ in the reference configuration.\footnote{This preclude the modeling of beams with kinks as the tangent vector would not be continuously defined at those points. In such a case, the beam should be modeled in two separate parts linked together in a rigid manner.}\textsuperscript{,}\footnote{The centerline is not $\mathcal{C}^2$ as discontinuities in curvature may occur. For instance, if no punctual loads are applied, the bending moment is continuous over the rod. As the bending moment is linked to the curvature through the constitutive equation $M = EI\varkappa$, a discontinuity in $I$ will lead to a discontinuity in $\varkappa$. Conversely, a discontinuity in $\varkappa$ will lead to a discontinuity in $I$.}

Here and subsequently, for such a function, the left and right limits at handle vertices ($s_{2i}$) will be denoted with superscripts $f_{2i}^-$ and $f_{2i}^+$. Possibly, the function is continuous so that the left and right limits agree ($f_{2i}^- = f_{2i}^+$).

% Matrix notation
% --------------------
\subsection{Matrix notation}
Here and subsequently, matrix notation will often be used to provide compact expressions for the equations, where the components of vector-valued functions are given in the material frame basis. This notation will be mixed with the vector notation employed  more generally throughout this document. Usually, if there is no comment in the manuscript, the meaning should be obvious and with no ambiguity to the reader.

For instance, all this expressions for the curvature binormal vector and the material curvatures vector will be considered equivalent and could be mixed together in the same equation~:
\begin{subequations}
	\begin{alignat}{1}
	&\vect{\kappa b} 
	= \kappa_1 \vect{d}_1 +  \kappa_2 \vect{d}_2 
	= \begin{bmatrix} \kappa_1 & \kappa_2 & 0 \end{bmatrix}^T
	\\
	&\vect{\varkappa} 
	= \varkappa_1 \vect{d}_1 +  \varkappa_2 \vect{d}_2 +  \varkappa_3 \vect{d}_3 
	= \begin{bmatrix} \varkappa_1 & \varkappa_2 & \varkappa_3 \end{bmatrix}^T
	= (1+\epsilon) \begin{bmatrix} \kappa_1 & \kappa_2 & \tau \end{bmatrix}^T
	\end{alignat}
\end{subequations}
The force strains vector is given by :
\begin{equation}
	\vect{\eta} = (1+\epsilon)\vect{d}_3 = \begin{bmatrix} 0 & 0 & 1+\epsilon \end{bmatrix}^T
\end{equation}
Internal forces are composed of a shear force and an axial force given by~:
\begin{subequations}
	\begin{alignat}{3}
	&\vect{F} 
	&&= F_1 \vect{d}_1 +  F_2 \vect{d}_2 + N \vect{d}_3 
	= \begin{bmatrix} F_1 & F_2 & N \end{bmatrix}^T
	\\
	&\vect{F}^{\perp} 
	&&= F_1 \vect{d}_1 +  F_2 \vect{d}_2
	= \begin{bmatrix} F_1 & F_2 & 0 \end{bmatrix}^T
	\\
	&\vect{F}^{\para} &&= \vect{N}
	= N \vect{d}_3 
	= \begin{bmatrix} 0 & 0 & N \end{bmatrix}^T
	\end{alignat}
\end{subequations}
Internal moments are composed of a bending moment and a twisting moment given by~:
\begin{subequations}
	\begin{alignat}{3}
	&\vect{M} 
	&&= M_1 \vect{d}_1 +  M_2 \vect{d}_2 + Q \vect{d}_3 
	= \begin{bmatrix} M_1 & M_2 & Q \end{bmatrix}^T
	\\
	&\vect{M}^{\perp} 
	&&= M_1 \vect{d}_1 +  M_2 \vect{d}_2
	= \begin{bmatrix} M_1 & M_2 & 0 \end{bmatrix}^T
	\\
	&\vect{M}^{\para} &&= \vect{Q}
	= Q \vect{d}_3 
	= \begin{bmatrix} 0 & 0 & Q \end{bmatrix}^T
	\end{alignat}
\end{subequations}
With the help of the matrix notation, the constitutive equations \cref{eq:constitutive_b,eq:constitutive_c,eq:constitutive_d} together write in a single equation~:
\begin{equation}
	\mat{M} = \mat{B} (\vect{\varkappa} - \rconf{\vect{\varkappa}})
	= EI_1(\varkappa_1 - \rconf{\varkappa}_1) \vect{d}_1
	+ EI_2(\varkappa_2 - \rconf{\varkappa}_2) \vect{d}_2
	+ GJ (\varkappa_3 - \rconf{\varkappa}_3) \vect{d}_3
\end{equation}

%We also introduce the matrix notation for the derivatives of the internal forces and moments referring to the inertial frame of reference $\{\vect{x},\vect{y},\vect{z}\}$ and to the local frame $\{\vect{d}_{1},\vect{d}_{2},\vect{d}_{3}\}$. The (spatial) velocity of $\{\vect{d}_{1},\vect{d}_{2},\vect{d}_{3}\}$ implies that~:
%\begin{subequations}
%	\begin{alignat}{3}
%	&\vect{F}' = \vect{F}^{'|xyz} = \vect{F}^{'|123} + \vect{\varkappa} \times \vect{F}
%	\\
%	&\vect{M}' = \vect{M}^{'|xyz} = \vect{M}^{'|123} + \vect{\varkappa} \times \vect{M}
%	\end{alignat}
%\end{subequations}
%where $\vect{F}_{xyz}'$ and $\vect{M}_{xyz}'$ denote the derivative with respect to $s$ in the inertial frame of reference $\{\vect{x},\vect{x},\vect{z}\}$ whereas $\vect{F}_{123}'$ and $\vect{M}_{123}'$ denote the derivative with respect to $s$ in the local material frame basis $\{\vect{d}_{1},\vect{d}_{2},\vect{d}_{3}\}$. Thus the matrix notation for $\vect{F}_{123}'$ and $\vect{M}_{123}'$ are given by :
%\begin{subequations}
%	\begin{alignat}{3}
%	&\vect{F}^{'|123} 
%	&&= F_1' \vect{d}_1 +  F_2' \vect{d}_2 + N' \vect{d}_3 
%	= \begin{bmatrix} F_1' & F_2' & N' \end{bmatrix}^T
%	\\
%	&\vect{M}^{'|123} 
%	&&= M_1' \vect{d}_1 +  M_2' \vect{d}_2 + Q' \vect{d}_3 
%	= \begin{bmatrix} M_1' & M_2' & Q' \end{bmatrix}^T
%	\end{alignat}
%\end{subequations}

% Discret extension and axial force
% --------------------------------------------
\subsection{Discret extension and axial force}
We assume the axial force ($\vect{N}$) to vary linearly over $]\vect{x}_{2i},  \vect{x}_{2i+2}[$ regarding the arc length parameter. The variation occurs if the segment is subject to a uniform distributed load $f_3$ over the segment. Consequently, the axial strain $\epsilon$ is also required to vary linearly. The value of the axial extension at mid span of each edge is given by~:
\begin{equation}
	\epsilon_{i+1/2} = {l_{i}}\,/\,{\rconf{l}_i} - 1 \quad , \quad i \in \llbracket 0, n_e-1 \rrbracket
\end{equation}
Consequently, the axial force at mid span of each edge is computed directly with the constitutive equation \cref{eq:constitutive_a} as~:
\begin{subequations}
	\begin{alignat}{3}
	\vect{N}_{2i+1/2} &= N_{2i+1/2}\, \vect{u}_{2i} \quad &&, \quad {N_{2i+1/2}} = ES_i \,\epsilon_{2i+1/2}
	\\
	\vect{N}_{2i+3/2} &= N_{2i+3/2}\, \vect{u}_{2i+1}\quad &&, \quad {N_{2i+3/2}} = ES_i \,\epsilon_{2i+3/2}
	\end{alignat}
\end{subequations}
Remark the sign convention~: as expected, when edge $\vect{e}_i$ suffers a positive extension ($\epsilon_{i+1/2} > 0$), vertex $\vect{x}_{i+1}$ \textquote{attracts} vertex $\vect{x}_{i}$ to it as $\vect{d}_{3,i+1/2} = \vect{u}_{i}$ is pointing from $\vect{x}_{i}$ towards $\vect{x}_{i+1}$. Remark also that $\epsilon_{i+1/2} = 0 \Leftrightarrow l_i = \rconf{l}_i$ when the rod is not stretched.

% Discret bending moments and curvatures
% -------------------------------------------------------
\subsection{Discret curvature and bending moment}
We assume that the internal bending moment and curvature are quadratic functions of the arc length parameter over $]\vect{x}_{2i},  \vect{x}_{2i+2}[$.
Although they must be continuous over this interval, they might be discontinuous at handle vertices and be subjected to jump discontinuities in direction and magnitude.

%\clearpage
\def\tabularxcolumn#1{m{#1}} % vertical center in X column

\subsubsection{Geometric curvature at ghost vertices}
% --------------------------------------------------------
For a given geometry of the centerline, the curvature binormal vector at ghost vertex  $\vect{x}_{2i-1}$ (resp. $\vect{x}_{2i+1}$) is computed considering the circumscribed osculating circle passing through the vertices ($\vect{x}_{2i-2}, \vect{x}_{2i-1},  \vect{x}_{2i}$) of the ($i-1$)th segment -- resp. through the vertices ($\vect{x}_{2i}, \vect{x}_{2i+1},  \vect{x}_{2i+2}$) of the $i$th segment.

\begin{tabularx}{\textwidth}[t]{>{\centering\arraybackslash}m{0.48\textwidth} >{\centering\arraybackslash}X} % >{\centering\arraybackslash}
	\includegraphics[]{E1.pdf}
	& 
	$\begin{aligned}[t] % placement: default is "center", options are "top" and "bottom"
	\vect{\kappa b}_{2i-1} 	& =  \frac{2}{L_{i-1}} \vect{u}_{2i-2} \times \vect{u}_{2i-1}\\[0.5em]
	\vect{\kappa b}_{2i+1} 	& =  \frac{2}{L_{i}} \vect{u}_{2i} \times \vect{u}_{2i+1} 
	\end{aligned}$
\end{tabularx}


\subsubsection{Unit tangent vector at ghost vertices}
% ---------------------------------------------------------------------

This definition of the curvature leads to a natural definition of the unit tangent vector at ghost vertex $\vect{x}_{2i-1}$ (resp. $\vect{x}_{2i+1}$), as the unit vector tangent to the osculating circle of the ($i-1$)th segment (resp. $i$th segment) at that point. 

\begin{tabularx}{\textwidth}[t]{>{\centering\arraybackslash}m{0.48\textwidth} >{\centering\arraybackslash}X} % >{\centering\arraybackslash}
	\includegraphics[]{E2.pdf}
	& 
	$\begin{aligned}[t] % placement: default is "center", options are "top" and "bottom"
	\vect{t}_{2i-1}	&=  \frac{l_{2i-1}}{L_{i-1}} \vect{u}_{2i-2}	+ 	\frac{l_{2i-2}}{L_{i-1}} \vect{u}_{2i-1} 	\\[0.5em]
	\vect{t}_{2i+1} 	&=  \frac{l_{2i+1}}{L_{i}} \vect{u}_{2i}		+ 	\frac{l_{2i}}{L_{i}} \vect{u}_{2i+1} 	
	\end{aligned}$
\end{tabularx}

\subsubsection{Left/right unit tangent vector at handle vertices}
% -----------------------------------------------------------------------------------
Equivalently, the definition of the osculating circles of the ($i-1$)th and $i$th segments leads to a natural definition of the left ($\vect{t}_{2i}^-$) and right ($\vect{t}_{2i}^+$) unit tangent vectors at handle vertex $\vect{x}_{2i}$, for segments of uniform curvature. When both segments have the same curvature, left and right vectors agree.

\begin{tabularx}{\textwidth}[t]{>{\centering\arraybackslash}m{0.48\textwidth} >{\centering\arraybackslash}X} % >{\centering\arraybackslash}
	\includegraphics[]{E3.pdf}
	& 
	$\begin{aligned}[t] % placement: default is "center", options are "top" and "bottom"
	\vect{t}_{2i}^- 	&= 2 (\vect{t}_{2i-1} \cdot \vect{u}_{2i-1}) \vect{u}_{2i-1} - \vect{t}_{2i-1} \\[0.5em]
	\vect{t}_{2i}^+ 	&= 2 (\vect{t}_{2i+1} \cdot \vect{u}_{2i}) \vect{u}_{2i} - \vect{t}_{2i+1}
	\end{aligned}$
\end{tabularx}

\subsubsection{Unit tangent vector at handle vertices}
% ----------------------------------------------------------------------
The unit tangent vector $\vect{t}_{2i}$ -- that is the cross-section normal -- at handle vertex $\vect{x}_{2i}$ is chosen to be the mean of the left and right unit tangent vectors at that vertex.\footnote{Consequently, this model assumes that the field of tangents along the centerline is continuous and is thus unable to model cases where the centerline is not at least $\mathcal{C}^1$. In such case the beam must be considered as two parts glued together.}

\begin{tabularx}{\textwidth}[t]{>{\centering\arraybackslash}m{0.48\textwidth} >{\centering\arraybackslash}X} % >{\centering\arraybackslash}
	\includegraphics[]{E4.pdf}
	& 
	$\begin{aligned}[t] % placement: default is "center", options are "top" and "bottom"
	\vect{t}_{2i} 	&= \frac{\vect{t}_{2i}^- + \vect{t}_{2i}^+ }{\norm{\vect{t}_{2i}^- + \vect{t}_{2i}^+}}
	\end{aligned}$
\end{tabularx}

This way, the determination of the tangent vectors -- or equivalently the section normals -- in the static equilibrium configuration will be done in the flow of the dynamic relaxation process, without the need of introducing any additional degrees of freedom (for instance the usual Euler angles). The position of the vertices rules the orientation of the cross-section normals.

\subsubsection{Left/right bending moment at handle vertices}
% ---------------------------------------------------------------------------------
Given the unit tangent vector $\vect{t}_{2i}$, one can define the left ($\vect{\kappa}_{2i}^-$) and right ($\vect{\kappa}_{2i}^+$) curvature at handle vertex $\vect{x}_{2i}$. The left curvature is initially evaluated from the left osculating circle, defined as the circle passing through $\vect{x}_{2i-1}$ and $\vect{x}_{2i}$ and tangent to $\vect{t}_{2i}$ at $\vect{x}_{2i}$. The right curvature is initially evaluated from the right osculating circle, defined as the circle passing through $\vect{x}_{2i}$ and $\vect{x}_{2i+1}$ and tangent to $\vect{t}_{2i}$ at $\vect{x}_{2i}$.\footnote{Remark that the centerline is now approximated with a biarc in the vicinity of $\vect{x}_{2i}$. This is the reason why this model is called the \textquote{biarc model}.}${}^,$\footnote{This model offers the ability to represent discontinuities in curvature -- thus in bending moment -- at handle vertices as the left and right curvatures does not necessarily agree. This is quite different from the classical 3-dof element~\cite{Barnes1999, Adriaenssens1999, Douthe2006} which assumes that the curvature -- thus the bending moment -- is $\mathcal{C}^0$ and can be evaluated at every vertices from the circumscribed osculating circle.}

\begin{tabularx}{\textwidth}[t]{>{\centering\arraybackslash}m{0.48\textwidth} >{\centering\arraybackslash}X} % >{\centering\arraybackslash}
	\includegraphics[]{E5.pdf}
	& 
	$\begin{aligned}[t] % placement: default is "center", options are "top" and "bottom"
	\vect{\kappa b}_{2i}^- &=  \frac{2}{l_{2i-1}} \vect{u}_{2i-1} \times \vect{t}_{2i}
	\\[0.5em]
	\vect{\kappa b}_{2i}^+ &=  \frac{2}{l_{2i}} \vect{t}_{2i} \times \vect{u}_{2i}
	\end{aligned}$
\end{tabularx}

However, this values need to be adjusted so that the static condition for rotational equilibrium is satisfied at all time ($\vect{M}^{ext}  + \vect{M}^+ - \vect{M}^- = 0$). Therefore, this condition will be satisfied in particular at the end of the solving process. To achieve this goal, we first compute a realistic mean value ($\vect{M}_{2i}$) for the internal bending moment as~:
\begin{equation}
		\vect{M}_{2i}^{\perp}	=  \frac{1}{2} \mat{B}_{i-1}(\vect{\kappa b}_{2i}^- - \rconf{\vect{\kappa b}}_{2i}^-)
					+  \frac{1}{2} \mat{B}_{i}(\vect{\kappa b}_{2i}^+ - \rconf{\vect{\kappa b}}_{2i}^+)
\end{equation}
To enforce the jump discontinuity in bending moment ($\vect{M}^{ext} = \vect{M}^- - \vect{M}^+$) across the handle vertex, we define the left and right bending moments at $\vect{x}_{2i}$ as~:
\begin{subequations}
	\begin{align}
		{\vect{M}_{2i}^{\perp}}^{-} &=  \vect{M}_{2i}^{\perp}	 + \frac{1}{2} \vect{M}_{2i}^{\perp,\;ext}
		\\[0.5em]
		{\vect{M}_{2i}^{\perp}}^{+} &=   \vect{M}_{2i}^{\perp}	 - \frac{1}{2} \vect{M}_{2i}^{\perp,\;ext}
	\end{align}
	\label{eq:DeltaM}
\end{subequations}
Note that in the case where no external concentrated bending moment is applied to the handle vertex, the internal bending moment is continuous across the vertex as expected.

\subsubsection{Left/right curvature at handle vertices}
% --------------------------------------------------------------------
Finally, the left and right curvature at handle vertex $\vect{x}_{2i}$ are computed back with the constitutive law~:
\begin{subequations}
	\begin{align}
		\vect{\kappa b}_{2i}^-  &=  \mat{B}_{i-1}^{\;-1} {\vect{M}_{2i}^{\perp}}^{-} + \rconf{\vect{\kappa b}}_{2i}^- 
		\\[0.5em]
		\vect{\kappa b}_{2i}^+  &=  \mat{B}_{i}^{\;-1} {\vect{M}_{2i}^{\perp}}^{+} + \rconf{\vect{\kappa b}}_{2i}^+ 
	\end{align}
\end{subequations}

\subsubsection{Bending moment at ghost vertices}
% -----------------------------------------------------------------
The internal bending moment at ghost vertices is simply given by the constitutive law as~:
\begin{subequations}
	\begin{align}
		\vect{M}_{2i-1}^{\perp} &=  \mat{B}_{i-1}(\vect{\kappa b}_{2i-1} - \rconf{\vect{\kappa b}}_{2i-1})
		\\[0.5em]
		\vect{M}_{2i+1}^{\perp} &=  \mat{B}_{i}(\vect{\kappa b}_{2i+1} - \rconf{\vect{\kappa b}}_{2i+1})
	\end{align}
\end{subequations}

\subsection{Discret rate of twist and twisting moment}
% =======================================
We assume the twisting moment and the rate of twist to vary linearly over $]\vect{x}_{2i},  \vect{x}_{2i+2}[$.
Thus, the material twist of the rod at mid edge is given by~:
\begin{subequations}
	\begin{align}
		\tau_{i+1/2} = \frac{\Delta\theta_{i}}{{l}_i}\label{eq:d_twist}
		\\[0.5em]
		\varkappa_{3,\,i+1/2} = \frac{\Delta\theta_{i}}{\rconf{l}_i}\label{eq:d_twist}
	\end{align}
\end{subequations}
To compute $\Delta\theta_{i} = \theta_{i+1} - \theta_{i}$ imagine that the rod si framed with a Bishop frame $\{\vect{u},\vect{v},\vect{t}\}$. Because the material frame $\{\vect{d}_1,\vect{d}_2,\vect{d}_3\}$ is also adapted to the rod centerline, it can be transformed into the Bishop frame with a single rotation of angle $\theta(s)$ around $\vect{d}_3(s) =\vect{t}(s)$. Because the Bishop frame does not twist around $\vect{d}_3$, the rate of change of angle $\theta$ along the curve directly leads to the computation of the rate of twist as exposed in \cref{eq:d_twist}.

In the discrete case, although it is possible to frame the whole curve with a Bishop frame to achieve the computation of the rate of twist \cite{Lefevre2017}, it is more convenient to measure $\Delta\theta_{i}$ step by step using the existing material frames at vertices $\vect{x}_i$ and $\vect{x}_{i+1}$. This is done in a two step process : 
\begin{enumerate}
\item 
Parallel transport the material frame $\{\vect{d}_{1,i},\vect{d}_{2,i},\vect{d}_{3,i}\}$ at vertex $\vect{x}_i$ onto vertex $\vect{x}_{i+1}$. We call $\{\vect{d}_{1,i}^{\para}, \vect{d}_{2,i}^{\para},\vect{d}_{3,i}^{\para}\}$ the resulting framed positioned at $\vect{x}_{i+1}$ such that $\vect{d}_{3,i}^{\para} = \vect{d}_{3,i+1}$.
\item 
Measure $\Delta\theta_{i} = \angle{(\vect{d}_{1,i}^{\para},\vect{d}_{1,i+1})} = \angle{(\vect{d}_{2,i}^{\para},\vect{d}_{2,i+1})}$ as the oriented angle needed to align $\vect{d}_{1,i}^{\para}$ with $\vect{d}_{1,i+1}$ (or $\vect{d}_{2,i}^{\para}$ with $\vect{d}_{2,i+1}$) by a rotation of angle $\Delta\theta_{i}$ around $\vect{d}_{3,i+1} = \vect{t}_{i+1}$.
\end{enumerate}
Consequently, the twisting moment at mid span of each edge is computed directly with the appropriate constitutive equation :
\begin{subequations}
	\begin{alignat}{3}
	\vect{Q}_{2i+1/2} &= Q_{2i+1/2}\, \vect{u}_{2i} \quad &&,\quad {Q_{2i+1/2}} = GJ_i(\varkappa_{3,\,2i+1/2} - \rconf{\varkappa}_{3,\,2i+1/2})
	\\
	\vect{Q}_{2i+3/2} &= Q_{2i+3/2}\, \vect{u}_{2i+1}\quad &&, \quad {Q_{2i+3/2}} = GJ_i(\varkappa_{3,\,2i+3/2} - \rconf{\varkappa}_{3,\,2i+3/2})
	\end{alignat}
\end{subequations}
Remark the sign convention~: as expected, when edge $\vect{e}_i$ suffers a positive twist ($\varkappa_{3,\,i+1/2} > 0$), frame $\{\vect{d}_{1,i+1},\vect{d}_{2,i+1},\vect{d}_{3,i+1}\}$ makes frame $\{\vect{d}_{1,i},\vect{d}_{2,i},\vect{d}_{3,i}\}$ to rotate positively around $\vect{u}_i$ as $Q_{i+1/2} > 0$.

% Discret shear force
% --------------------------
\subsection{Discret shear force}
Recall that in Kirchhoff's theory the shear force is a reacting parameter, computed from the equilibrium equations and not from a constitutive law. Firstly, remark that the shear force can be factorized under the following expression~:
\begin{equation}
	\vect{F}^{\perp} = F_1 \vect{d}_1 + F_2 \vect{d_2} = - \vect{d}_3 \times (\vect{d}_3 \times \vect{F}) \label{eq:shearid}
\end{equation}
Then, combining \cref{eq:motion_4,eq:motion_5} --~where the inertial terms are neglected~-- with \cref{eq:shearid} leads to the following vectoriel form of the shear force~:
\begin{equation}
	\vect{F}^{\perp} 
	= (1+\epsilon)^{-1} \vect{d}_3 \times \left(\frac{\partial \vect{M}}{\partial s} + \vect{m} \right)
	=  \vect{d}_3 \times \left(\frac{\partial \vect{M}}{\partial s_t} + \frac{\vect{m}}{1+\epsilon} \right)
	\label{eq:shear} 
\end{equation}
In the discrete case, the shear force is evaluated at mid span of each edge by :
\begin{subequations}
	\begin{alignat}{3}
		&\vect{F}^{\perp}_{2i+1/2}
		=  \vect{u}_{2i} &&\times \left( \frac{\vect{M}_{2i+1} - \vect{M}_{2i}^{+}}{l_{2i}}+ \frac{\rconf{l}_{2i}}{l_{2i}} \vect{m}_i \right)
		\label{eq:dshear_a}
		\\[0.5em]
		&\vect{F}^{\perp}_{2i+3/2}
		=  \vect{u}_{2i+1} &&\times \left( \frac{\vect{M}_{2i+2}^- - \vect{M}_{2i+1}}{l_{2i+1}}+ \frac{\rconf{l}_{2i+1}}{l_{2i+1}} \vect{m}_i \right)
		\label{eq:dshear_b}
	\end{alignat}
	\label{eq:dshear}
\end{subequations}
Remark that the derivative of the internal moment at mid edge is evaluated by the finite difference of the moment between the two closest vertices. This is in accordance with the quadratic interpolation method of a vector-valued function given in \cref{ch:interpolation}. 

Expressed in the form of \cref{eq:dshear_a,eq:dshear_b}, the discrete shear force has the interesting property to remain strictly orthogonal to $\vect{d}_{3,i+1/2} = \vect{u}_i$. While this is true in the continuous world, this property can easily be lost in the discrete case where mean values and derivatives are evaluated through finite summations or finite differences.

%Equivalent equations could be expressed in a scalar form derived from \cref{eq:dshear_a,eq:dshear_b} as~:
%\begin{subequations}
%	\begin{alignat}{3}
%		&F_{1,\;2i+1/2}  =  \frac{\rconf{l}_{2i}}{l_{2i}}
%		 \left( 
%		 -\frac{M_{2,\,2i+1} - M_{2,\,2i}^{+}}{\rconf{l}_{2i}}
%		 - \varkappa_{3,\,2i+1/2}M_{1,\,2i+1/2}
%		 +\varkappa_{1,\,2i+1/2}Q_{2i+1/2}
%		 \right)
%		\\[0.5em]
%		&\vect{F}^{\perp}_{2i+3/2}
%		=  \vect{u}_{2i+1} &&\times \left( \frac{\vect{M}_{2i+2}^- - \vect{M}_{2i+1}}{l_{2i+1}}+ \frac{\rconf{l}_{2i+1}}{l_{2i+1}} \vect{m}_i \right)
%		\label{eq:dshear_b}
%	\end{alignat}
%\end{subequations}

\subsubsection{Matrix notation}
Because there is a derivation with respect to $s$ in \cref{eq:dshear_a,eq:dshear_b}, one must be very careful when writing these equations in matrix notation. Indeed, their counterparts will translate differently wether the symbols will be decomposed in the \emph{global} frame basis or in the \emph{material} frame basis.

If the symbols are decomposed in the \emph{global} frame basis the translation is straightforward as the derivative of a vector is the vector of the derived components~:
\begin{equation}
	\vect{M} = {\begin{bmatrix}M_x \\ M_y \\ M_z\end{bmatrix}}
	\quad , \quad
	\vect{M}'
	=
	{\begin{bmatrix}M_x \\ M_y \\ M_z\end{bmatrix}}^{'}
	=
	\begin{bmatrix}M_x' \\ M_y' \\ M_z'\end{bmatrix}
\end{equation}
Thus, in the discrete case, the evaluation of the derivative of the moment at mid-edge is achieved thanks to the finite difference formula~:
\begin{equation}
	\vect{M}'_{2i+1/2}
	\simeq
	\frac{1}{\rconf{l}_{2i}}\left( {\begin{bmatrix}M_x & M_y & M_z\end{bmatrix}}_{2i+1}^T - {\begin{bmatrix}M_x & M_y & M_z\end{bmatrix}}_{2i}^T \right)
\end{equation}
However, if the symbols are given in the \emph{material} frame basis, the derivation must take into account the spatial velocity $\vect{\varkappa}$ of the material frame~:
\begin{equation}
	\vect{M} = {\begin{bmatrix}M_1 \\ M_2 \\ Q \end{bmatrix}}
	\quad , \quad
	\vect{M}'
	=
	{\begin{bmatrix}
	M_1 \\ M_2 \\ Q
	\end{bmatrix}}^{'}
	=
	\begin{bmatrix}
	M_1' \\ M_2' \\ Q'
	\end{bmatrix}
	+
	\begin{bmatrix}
	\varkappa_1 \\ {\varkappa_2} \\ \varkappa_3
	\end{bmatrix}
	\times
	\begin{bmatrix}
	M_1 \\ M_2 \\ Q
	\end{bmatrix}
\end{equation}
Thus, in the discrete case, the evaluation of the derivative of the moment at mid-edge is still achieved thanks to the finite difference formula, but takes a very different matrix form~:
\begin{equation}
	\begin{aligned}
	\vect{M}'_{2i+1/2}
	&\simeq
	&&\frac{1}{\rconf{l}_{2i}}\left( {\begin{bmatrix}M_1 & M_2 & Q\end{bmatrix}}_{2i+1}^T - {\begin{bmatrix}M_1 & M_2 & Q\end{bmatrix}}_{2i}^T \right)
	\\
	&+ &&\frac{1}{2}\left( {\begin{bmatrix}\varkappa_1 & \varkappa_2 & \varkappa_3\end{bmatrix}}_{2i}^T + {\begin{bmatrix}\varkappa_1 & \varkappa_2 & \varkappa_3\end{bmatrix}}_{2i+1}^T \right)
	\\
	&\times 
	&& \frac{1}{2} \left( {\begin{bmatrix}M_1 & M_2 & Q\end{bmatrix}}_{2i}^T + {\begin{bmatrix}M_1 & M_2 & Q\end{bmatrix}}_{2i+1}^T \right)
	\end{aligned}
\end{equation}
Although this paragraph could seem superfluous to the reader, this point is a matter of concern when implementing the model into an algorithm. Indeed, the developper always has the choice between two natural data structures where vectors are represented by a triplet either in the global frame basis or in the material frame basis (see \cref{eq:stiffnessmatrix}). Even more, he can decide to mix the two for practical reasons, for instance if it leads to less arithmetic computations. In particular, the stiffness matrix has a nice diagonal shape when written in the material frame basis. Thus it seems desirable to do the computation of the bending moment in this basis. On the contrary, we've just seen that it seems easier to compute the shear force in the global frame basis.

\subsection{Interpolation}
At this point, for a given geometric configuration, we know how to compute the bending moment at vertices. But we only know how to compute the twisting moment, the axial force and the shear force at mid edges. However, our final goal is to described the discrete rod as a particle-spring system were mass is lumped at vertices and elements are modeled as interactions between vertices. In this representation, all actions must be resumed to vertex actions, the only conceptual entity that will have a meaning to the dynamic process.

Therefore, we need to express the value of the twisting moment, the axial force and the shear force at vertices and not only at mid edges. This can be done using \cref{eq:motion} were the inertial member is set to zero, that is neglecting the inertial forces. Although this is not exactly true during the dynamic of the rod, it is exactly true at static equilibrium, the only state we are interested in.

\subsubsection{Axial force}
From \cref{eq:motion_3} we evaluate the variation of the axial force over a segment $]\vect{x}_{i},  \vect{x}_{i+1}[$ and deduce the variation of axial strain from the constant axial stiffness $ES$ of the segment~: 
\begin{subequations}
	\begin{alignat}{2}
		&\Delta N_{i+1/2} &&= -l_i  \cdot {[\varkappa_1 F_2 - \varkappa_2 F_1 + f_3]}_{i+1/2}
		\label{eq:DeltaN}
		\\
		&\Delta \epsilon_{i+1/2} &&= \Delta N_{i+1/2} / {ES}_i
	\end{alignat}
\end{subequations}
Then we conclude on the expression of the axial force at vertices~:
\begin{subequations}
	\begin{alignat}{2}
		&N_{i}^{+} &&= N_{i+1/2} - \frac{1}{2} \Delta N_{i+1/2}  \\[0.5em]
		&N_{i+1}^{-} &&= N_{i+1/2} + \frac{1}{2} \Delta N_{i+1/2}
	\end{alignat}
	\label{eq:dNi}
\end{subequations}
and the expression of the axial strain at vertices~:
\begin{subequations}
	\begin{alignat}{2}
		&\epsilon_{i}^{+} &&= \epsilon_{i+1/2} - \frac{1}{2} \Delta \epsilon_{i+1/2}  \\[0.5em]
		&\epsilon_{i+1}^{-} &&= \epsilon_{i+1/2} + \frac{1}{2} \Delta \epsilon_{i+1/2}
	\end{alignat}
\end{subequations}
Remark how a distributed external axial force modifies the value of the axial component of the internal force at vertices, and thus is taken into account in the final static equilibrium.

\subsubsection{Shear force}
From \cref{eq:motion_1,eq:motion_2} we evaluate the variation of the shear force over a segment $]\vect{x}_{i},  \vect{x}_{i+1}[$ ~: 
\begin{subequations}
	\begin{alignat}{2}
		&\Delta F_{1,\,i+1/2}^{} &&= - l_i  \cdot {[\varkappa_2 F_3 - \varkappa_3 F_2 + f_1]}_{i+1/2}
		\\
		&\Delta F_{2,\,i+1/2}^{} &&= - l_i  \cdot {[\varkappa_3 F_1 - \varkappa_1 F_3 + f_2]}_{i+1/2}
	\end{alignat}
	\label{eq:DeltaF}
\end{subequations}
Then we conclude on the expression of the shear force components at vertices~:
\begin{subequations}
	\begin{alignat}{2}
		&F_{1,\,i}^{+} &&= F_{1,\,i+1/2} - \frac{1}{2} \Delta F_{1,\,i+1/2}  \\[0.5em]
		&F_{1,\,i+1}^{-} &&= F_{1,\,i+1/2} + \frac{1}{2} \Delta F_{1,\,i+1/2} \\[0.5em]
		&F_{2,\,i}^{+} &&= F_{2,\,i+1/2} - \frac{1}{2} \Delta F_{2,\,i+1/2}  \\[0.5em]
		&F_{2,\,i+1}^{-} &&= F_{2,\,i+1/2} + \frac{1}{2} \Delta F_{2,\,i+1/2}
	\end{alignat}
	\label{eq:dFi}
\end{subequations}
Remark how a distributed external shear force modifies the value of the shear components of the nternal force at vertices, and thus is taken into account in the final static equilibrium.

\subsubsection{Twisting moment}
From \cref{eq:motion_6} we evaluate the variation of the twisting moment over a segment $]\vect{x}_{i},  \vect{x}_{i+1}[$ and deduce the variation of twist from the constant torsional stiffness $GJ$ of the segment~: 
\begin{subequations}
	\begin{alignat}{2}
		&\Delta Q_{i+1/2} &&= -l_i  \cdot {[\varkappa_1 M_2 - \varkappa_2 M_1 + m_3]}_{i+1/2}
		\label{eq:DeltaQ}
		\\
		&\Delta \varkappa_{3,\,i+1/2} &&= \Delta Q_{i+1/2} / {GJ}_i
	\end{alignat}
\end{subequations}
Then we conclude on the expression of the twisting moment at vertices~:
\begin{subequations}
	\begin{alignat}{2}
		&Q_{i}^{+} &&= Q_{i+1/2} - \frac{1}{2} \Delta Q_{i+1/2}  \\[0.5em]
		&Q_{i+1}^{-} &&= Q_{i+1/2} + \frac{1}{2} \Delta Q_{i+1/2}
	\end{alignat}
	\label{eq:dQi}
\end{subequations}
and the expression of the rate of twist at vertices~:
\begin{subequations}
	\begin{alignat}{2}
		&\varkappa_{3,\,i}^{+} &&= \varkappa_{3,\,i+1/2} - \frac{1}{2} \Delta \varkappa_{3,\,i+1/2}  \\[0.5em]
		&\varkappa_{3,\,i+1}^{-} &&= \varkappa_{3,\,i+1/2} + \frac{1}{2} \Delta \varkappa_{3,\,i+1/2}
	\end{alignat}
\end{subequations}
Remark how a distributed external twisting moment modifies the value of the axial component of the internal moment at vertices, and thus is taken into account in the final static equilibrium.







\clearpage
\section{Dynamic relaxation}
From the previous section we have established the basis for a discrete rod element that can account for extension, flexion and torsion. This element is made of two types of vertices~: the ghost and the handle vertices. This allows to model discontinuities at handle vertices, which is one of the main contribution of the work exposed in this chapter. We have established a precise discrete geometric representation of a slender rod. And from a given configuration we have learned to compute the internal force and moment acting on rod vertices using Kirchhoff's theory. Therefore, we are able to compute the resultant of the internal force and moment acting on a given vertex of the rod.\footnote{Note that the internal force and moment embed the action of distributed external force and moment applied to the rod.}

We now expose a process to find the static equilibrium of a rod, which is our ultimate goal. This process is called \emph{Dynamic relaxation} and was first introduced by \citef{Day1965}. We assume that we know the stress-free configuration of the rod, its material properties and cross-section properties. The rod might also be subjected to known external loads such as climatic loads. Finally, we call initial configuration the actual configuration of the rod at time $t=0$. In this configuration, the rod is (a priori) not at static equilibrium.

In the dynamic relaxation procedure, a discretized mechanical system is dropped from a known initial configuration at time $t=0$. Because the system is not yet in a state of static equilibrium, the internal forces does not equilibrates the external forces. Thus, the system is subject to a motion. This motion is integrated through time and artificially damped. When all the kinetic energy is dissipated by the damping the system has reached a state of static equilibrium.

Because the motion is only a mean to find the position of the system in a static equilibrium, the damping does not need to be realistic and should be chosen so that the system approaches the static position as fast as possible.

Here, we use the fictitious kinetic damping proposed by Cundall in 1976.
\citef{Belytschko1983}
L’amortissement cinétique a été proposé par P. Cundall en 1976 [35]
with an explicit scheme (central difference time integrator)


\subsection{Stages of the procedure}
Previously, we have idealized our mechanical system as a \dofs{4} particle spring system where each vertex is assimilated as a \emph{particle}, also called \emph{node}, represented by a material frame. Each node has its own mass and is subjected to internal and external forces. If not balanced, the node moves as it is not in a state of equilibrium.

\subsection{Resultants acting on a particle}\label{sec:resFM}
In this section, we express the resultant force and the resultant twisting moment acting on a particle. If not balanced, these resultants will make the particle to move and rotate with respect to its degrees of freedom $\vect{x}$ and $\theta$.

\subsubsection{Resultant force}
The translational resultant force ($\vect{R}_i^x$) acting on a particle is the sum of two contributions. The first one ($\vect{F}_i^{ext}$) is the resultant of the concentrated forces applied to the particle such as climatic loads, support reactions or loads transferred through connections. The second one ($\vect{F}_i^{int}$) is the resultant of the internal forces applied by the upstream and downstream parts of the rod to the particle and given by \cref{eq:dNi,eq:dFi}. This leads to the following equations~: \footnote{Recall the convention from \cref{sec:}~: the internal force and moment are chosen to be the action of the downstream part of the rod upon the upstream part of the rod.}
\begin{subequations}
\begin{alignat}{2}
	&\vect{R}_i^x &&= \vect{F}_i^{int} + \vect{F}_i^{ext} 
	\\
	&\vect{F}_i^{int} &&= - \vect{F}_i^{-} + \vect{F}_i^{+} 
	\\
	& \vect{F}_i^{-}  &&= N_i^- \,\vect{d}_{3,\,i}  + F_{1,\,i}^{-} \,\vect{d}_{1,\,i}  + F_{2,\,i}^{-} \,\vect{d}_{2,\,i}
	\\
	&\vect{F}_i^{+}  &&= N_i^+ \,\vect{d}_{3,\,i}  + F_{1,\,i}^{+} \,\vect{d}_{1,\,i}  + F_{2,\,i}^{+} \,\vect{d}_{2,\,i}
\end{alignat}
\end{subequations}
Note that the contribution of the distributed external forces ($\vect{f}_i^{ext}$) is already taken into account via the interpolation of the internal force (see \cref{eq:DeltaN,eq:DeltaF}). Likewise, the contribution of the distributed external bending moment ($\vect{m}_i^{\perp,\,ext}$) is also taken into account via the calculation of the internal shear force (see \cref{eq:dshear}). Finally, the contribution of the concentrated external bending moments is yet included via the expression of the discrete shear force (see \cref{eq:DeltaM,eq:dshear}).

\subsubsection{Resultant twisting moment}
In the same manner, the rotational resultant moment ($R_i^{\theta}$) acting on a particle is the sum of two contributions.\footnote{Actually, $R_i^{\theta}$ is the component of the resultant moment along $\vect{d}_{3,\,i}$. We only need to compute this component as we have only one rotational degree of freedom in our model.} The first one ($Q_i^{ext}$) is the resultant of the concentrated twisting moments applied to the particle. The second one (${Q}_i^{int}$) is the resultant of the internal twisting moment applied by the upstream and downstream parts of the rod to the particle and given by \cref{eq:dQi}. This leads to the following equations~:
\begin{subequations}
\begin{alignat}{2}
	&{R}_i^{\theta} &&= {Q}_i^{int} + {Q}_i^{ext} 
	\\
	&{Q}_i^{int} &&= - {Q}_i^{-} + {Q}_i^{+} 
\end{alignat}
\end{subequations}
Note that the contribution of the distributed external twisting moment ($q_i^{ext}$) is already taken into account via the interpolation of the internal twisting moment (see \cref{eq:DeltaQ}).

\subsection{Equations of motion}
The particles of the system evolves according to the laws of motion, with respect to the 4 degrees of freedom of the system ($\vect{x}$ and $\theta$), given by~:
\begin{subequations}
\label{eq:dmotion}
\begin{alignat}{3}
	& m_i^x\; \ddot{\vect{x}}_i  + \lambda^x_i \dot{\vect{x}}_i && = \vect{R}_i^x \label{eq:dmotion_a}
	\\
	& m_i^{\theta} \; \ddot{\theta}_i + \lambda^{\theta}_i \dot{\theta}_i&& = R_i^{\theta} \label{eq:dmotion_b}
\end{alignat}
\end{subequations}
where $\ddot{\vect{x}}_i$ is the translational acceleration of the particle, $\ddot{\theta}_i$ is the rotational acceleration of the particle and $\lambda^x_i$ and  $\lambda^{\theta}_i$ are the viscous damping coefficients.

Hereinafter we will consider no viscous damping. Instead, we will rely on an artificial kinetic damping (see \cref{sec:damping}). For a detailed traitement of various damping methods in the dynamic relaxation method, refer to \cite{Belytschko1983,Rezaiee2012}.

\subsubsection{Coupling between flexion and torsion}
Although \cref{eq:dmotion_a,eq:dmotion_b} may seem uncoupled to the reader, it is not the case as the coupling occurs through the material frame (see \cref{sec:dofchain}). Recall that both $\vect{R}_i^x$ and $R_i^{\theta}$ do depend on the $\vect{x}_i$ and $\theta_i$ variables.

\subsubsection{Nonlinearity}
In a linear analysis the expression of the resultant force and the resultant moment would be linearized and written in the matrix form~:
\begin{subequations}
\begin{alignat}{3}
	& \mat{M}^x\; \mat{\ddot{X}}  + \mat{\lambda}^x \mat{\dot{X}} && = \mat{K}^x \mat{X}
	\\
	& \mat{M}^{\theta} \; \mat{\ddot{\Theta}} + \mat{\lambda}^{\theta} \mat{\dot{\Theta}}&& =  \mat{K}^{\theta}\mat{\Theta}
\end{alignat}
\end{subequations}
where $\mat{X}$ and $\mat{\Theta}$ are the column vectors of the translational and rotational degrees of freedom of the system~; $\mat{M}^{x}$ and $\mat{M}^{\theta}$ are the mass matrices~; $\mat{\lambda}^{x}$ and $\mat{\lambda}^{\theta}$ are the damping matrices and $\mat{K}^x$ and $\mat{K}^{\theta}$ are the stiffness matrices. 

Saying that the system is linearized involves that the dependence of $\vect{R}_i^x$ and $R_i^{\theta}$ with respect to the degrees of freedom $\vect{x}_i$ and $\theta_i$ will be modeled as a (linear) matrix product and that $\mat{K}^x$ and $\mat{K}^{\theta}$ are computed independently of these variables. In other words, this means that $\vect{R}_i^x$ and $R_i^{\theta}$ are calculated as a linear combination of the degrees of freedom, and that the coefficients of this combination are the matrix entries of  
$\mat{K}^x$ and $\mat{K}^{\theta}$.

Here, this factorization is not possible. $\vect{R}_i^x$ and $R_i^{\theta}$ are computed from the degrees of freedom of the system but the relation is not linear (see how the internal force and moment are computed in \cref{sec:dmodel}). Therefore, the geometric system given in \cref{eq:dmotion_a,eq:dmotion_b} is effectively nonlinear.

\subsection{Explicite time integration}

In this section, we give the stages required to integrate these equations through time. The dynamic relaxation procedure is based on a central-difference scheme. We call $\Delta t$ the time step. And we call \emph{initial configuration} the configuration of the system at time $t=0$.

Note that the time step $\Delta t$ is not necessary constant through time and could be \emph{adapted} during the analysis process. However, for simplicity we will treat only the case where it is constant but it is easy to extend the present work to work with a variable time step.

\subsubsection{Acceleration}
At time $t$, considering the position of the system is known ($\vect{x}_i$ and $\{\vect{d}_{3,\,i},\vect{d}_{1,\,i},\vect{d}_{2,\,i}\}$), we can compute the resultant force ($\vect{R}_i^x$) and the resultant twisting moment ($R_i^{\theta}$) acting on the particles (see \cref{sec:resFM}). Using \cref{eq:dmotion} the acceleration of the particles at time $t$ is straightforwardly deduced as~:
\begin{subequations}
\label{eq:da}
\begin{alignat}{3}
	& \ddot{\vect{x}}_i^t && = \frac{\vect{R}_i^x}{m_i^x}
	\\[0.5em]
	& \ddot{\theta}_i^t && = \frac{R_i^{\theta}}{m_i^{\theta}}
\end{alignat}
\end{subequations}

\subsubsection{Velocity}
The translational and rotational velocities of a particle are evaluated with the following central difference scheme~:
\begin{equation}
	a_i^t = \frac{v_i^{t+\Delta t / 2} - v_i^{t+\Delta t / 2}}{\Delta t}
\end{equation}
where $a_i$ is the acceleration an $v_i$ is the velocity of the particle. Thus, the translational and rotational velocities of a particle at time $t + \Delta t / 2$ are computed from the velocities at time $t - \Delta t / 2$ by~:
\begin{subequations}
\label{eq:dv}
\begin{alignat}{5}
	& \dot{\vect{x}}_i^{t+\Delta t / 2} &&
	=  \dot{\vect{x}}_i^{t-\Delta t / 2} 
	&&+ \Delta t  \cdot \frac{\vect{R}_i^x}{m_i^x}
	\\[0.5em]
	& \dot{\theta}_i^{t+\Delta t / 2} &&
	=  \dot{\theta}_i^{t-\Delta t / 2} 
	&&+ \Delta t  \cdot \frac{R_i^{\theta}}{m_i^{\theta}}
\end{alignat}
\end{subequations}

\subsubsection{Position}
To update the position of the system, we use the same central difference scheme but this time on the velocity~:
\begin{equation}
	v_i^{t+\Delta t / 2} = \frac{q_i^{t+\Delta t} - q_i^{t}}{\Delta t}
\end{equation}
where $v_i$ is the acceleration an $q_i$ is the position of the particle (either in translation or rotation). Thus, the translational and rotational positions of a particle at time $t + \Delta t$ are computed from the velocities at time $t + \Delta t / 2$ by~:
\begin{subequations}
\label{eq:dx}
\begin{alignat}{5}
	& \vect{x}_i^{t+\Delta t} 
	&& =  \vect{x}_i^{t} + \Delta t  \cdot  \dot{\vect{x}}_i^{t+\Delta t / 2}
	\\[0.5em]
	& {\theta}_i^{t+\Delta t} 
	&& =  {\theta}_i^{t} + \Delta t  \cdot  \dot{{\theta}}_i^{t+\Delta t / 2}
\end{alignat}
\end{subequations}
Using \cref{eq:dv} the position at time $t+\Delta t$ can be expressed with respect to the position, velocity and resultants computed at time $t$ as~:
\begin{subequations}
\label{eq:dx2}
\begin{alignat}{5}
	& \vect{x}_i^{t+\Delta t} 
	&& =  \vect{x}_i^{t} + \Delta t \cdot \dot{\vect{x}}_i^{t-\Delta t / 2} 	
	&&+ {\Delta t}^2  \cdot \frac{\vect{R}_i^x}{m_i^x}
	\\[0.5em]
	& {\theta}_i^{t+\Delta t} 
	&& =  {\theta}_i^{t} + \Delta t  \cdot  \dot{{\theta}}_i^{t- \Delta t / 2}
	&&+ {\Delta t}^2  \cdot \frac{R_i^{\theta}}{m_i^{\theta}}
\end{alignat}
\end{subequations}

\subsubsection{Motion}
From this new position, it is now possible to compute the new resultant force and moment acting on the particles, to update their acceleration, then to update their velocity, and then to compute the new position of the system, at time $t + 2\Delta t$. This process can be repeated indefinitely to follow the motion of the system.

\subsubsection{Initialization}
The iterative process described in this section to simulate step by step the motion of the system needs to be initialized. At the moment, \cref{eq:dx2} only describes how to get the position of the system at $t + \Delta t$ knowing its position, velocity and acceleartion at time $t$.

At time $t=0$, or each time that the system will be damped (see \cref{sec:damping}), we consider that the system is released wit no initial velocity, which means that~:
\begin{equation}
	v_i^{0} = \frac{1}{2} (v_i^{-\Delta t / 2} + v_i^{+\Delta t / 2}) = 0 
	\quad \Rightarrow \quad
	v_i^{-\Delta t / 2}   = - v_i^{+\Delta t / 2}
\end{equation}
Therefore, the velocity at time $\Delta t / 2$ given in \cref{eq:dv} becomes~:
\begin{subequations}
\label{eq:dv0}
\begin{alignat}{5}
	& \dot{\vect{x}}_i^{+\Delta t / 2} &&
	=  \frac{1}{2} \Delta t  \cdot \frac{\vect{R}_i^x}{m_i^x}
	\\[0.5em]
	& \dot{\theta}_i^{+\Delta t / 2} &&
	=  \frac{1}{2} \Delta t  \cdot \frac{R_i^{\theta}}{m_i^{\theta}}
\end{alignat}
\end{subequations}
and the next position at time $t + \Delta t$ is still computed from \cref{eq:dx}.
\subsubsection{Error propagation}
Note that the motion will be realistic to the extent that the computed forces and moments will be realistic and to the extent that the time step will be small enough. Indeed, at each time step an approximation error is done in the evaluation of the velocity and the position of the system with the central difference scheme. This error is integrated through time and nothing here is done to correct it and to prevent its accumulation along the dynamic. It is not a matter of concern for us as we are only interested in the quasi-static response of the system and not in a accurate modeling of the system's motion. Moreover, higher accuracy numerical integrators would be more computationally expensive, which is against our goal to achieve real time interactive simulation of elastic gridshells.

Lots of other integration schemes exist, among which we can cite the \emph{Explicit Euler}, the \emph{Symplectic Euler}, the \emph{Störmer-Verlet} and the \emph{4\textsuperscript{th} order Runge-Kutta} schemes. These schemes are briefly presented in \cite{Fierz2013}. For a complete treatment of numerical integrators refer to the book from \citef{Hairer2006}.

\subsection{Damping}\label{sec:damping}
If no damping is introduced to dissipate some energy, there is no reason that the system will stop to move. Here, our goal is to dissipate the kinetic energy of the system as fast as possible to fall into a state of static equilibrium. This can be achieved with any kind of damping, among which the most well-known are viscous and kinetic damping. 

Here, we choose to implement the kinetic damping as it is known to produce the best results for a wide range of cases \cite{Rezaiee2012}.

\subsubsection{Kinetic damping}
Kinetic damping was first introduced by \citef{Cundall1976}. The idea behind this type of damping is simple. For a conservative system, the mechanical energy ($\mathcal{E}_m$) is conserved during motion and is the sum of two forms of energy~: the potential energy ($\mathcal{E}_p$) and the kinetic energy ($\mathcal{E}_k$). Therefore, the potential energy of the system is minimized when its kinetic energy is maximized.

To find a state of static equilibrium, that is a state of minimal potential energy, Cundall proposes to track the kinetic energy of the system during motion. When a peak is detected, the system is frozen in its position and then released with no initial velocity, that is with no initia kinetic energy. When the system is released, the overall mechanical energy of the system has decreased and is all stocked under potential energy form. The motion start again and part of the initial potential energy is converted to kinetic energy, until a new peak is detected. Progressively, from peak to peak, the potential energy is progressively lowered to a minimum and the system falls in a state of static equilibrium.

Because of the discrete nature of the numerical process, a peak of kinetic energy is detected in the interval $[t-\Delta t/2,t+\Delta t/2]$ when~:
\begin{equation}
	\mathcal{E}_k^{t-\Delta t/2} >  \mathcal{E}_k^{t+\Delta t/2}
\end{equation}
where the kinetic energy of the system is computed from the mass and the velocity of the particles by~:
\begin{subequations}
\label{eq:Ek}
\begin{alignat}{5}
	& \mathcal{E}_k^{x,\,t-\Delta t/2} && =  \sum_i \tfrac{1}{2} m_i^x \dot{\vect{x}}_i^{t-\Delta t / 2} 
	\\[0.5em]
	& \mathcal{E}_k^{\theta,\,t-\Delta t/2} && = \sum_i \tfrac{1}{2} m_i^{\theta} \dot{{\theta}}_i^{t-\Delta t / 2} 
	\\[0.5em]
	& \mathcal{E}_k^{t-\Delta t/2} && = \mathcal{E}_k^{x,\,t-\Delta t/2} + \mathcal{E}_k^{\theta,\,t-\Delta t/2} 
\end{alignat}
\end{subequations}
Here, we have made the distinction between the translational part of the kinetic energy ($\mathcal{E}_k^{x}$) and the rotational part of the kinetic energy ($\mathcal{E}_k^{\theta}$). Indeed, the kinetic damping can be triggered either considering the global kinetic energy of the system or considering separately the translational and rotational parts of the kinetic energy of the system.\footnote{That is when a peak of $\mathcal{E}_k^{x}$ or a peak of $\mathcal{E}_k^{\theta}$ is detected the kinetic damping is triggered.}


\subsubsection{Peak interpolation}
When a peak is detected at time $t+\Delta t /2$, the simplest way to proceed is to froze the system in its actual position, at time $t$, and to release it from this position with no initial velocity. However, the peak of kinetic energy as occurred at time $t^*$ somewhere in between times $t-\Delta t/2$ and $t+\Delta t/2$. To maximise the effect of the kinetic damping the position of the peak could be guessed using a parabolic interpolation of the kinetic energy.

Let us define $\mathcal{E}_0$, $\mathcal{E}_1$ and $ \mathcal{E}_2$ the last three consecutive values of the kinetic energy~:
\begin{subequations}
\begin{alignat}{5}
	& \mathcal{E}_0 &&= \mathcal{E}_k^{t-\tfrac{3}{2}\Delta t}
	\\[0.5em]
	& \mathcal{E}_1 &&= \mathcal{E}_k^{t-\tfrac{1}{2}\Delta t}
	\\[0.5em]
	& \mathcal{E}_2 &&= \mathcal{E}_k^{t+\tfrac{1}{2}\Delta t}
\end{alignat}
\end{subequations}
We define the following parameters for the parabolic interpolation of the kinetic energy~:
\begin{subequations}
\label{eq:InterpParam}
\begin{alignat}{5}
	& \alpha = \frac{\mathcal{E}_1 - \mathcal{E}_0}{\mathcal{E}_1 - \mathcal{E}_2} \geqslant 0
	\\[0.5em]
	& \xi = \frac{\mathcal{E}_2 - \mathcal{E}_1}{\mathcal{E}_0 - 2\mathcal{E}_1 + \mathcal{E}_2} = \frac{1}{1 + \alpha} \in [0,1]
\end{alignat}
\end{subequations}
With these parameters, the position of the peak and the value of the kinetic energy at the peak are given by~:
\begin{subequations}
\label{eq:InterpEk}
\begin{alignat}{5}
	& t^* = t - \xi t
	\\[0.5em]
	& \mathcal{E}^* = \mathcal{E}_1 + \frac{1-2\xi}{8} (\mathcal{E}_2 - \mathcal{E}_0)
\end{alignat}
\end{subequations}
The system is then pushed backward ($\xi</2$) or forward ($\xi>1/2$) to the position $\vect{x}_i^*$ and $\theta_i^*$ given by~:
\begin{subequations}
\label{eq:InterpX}
\begin{alignat}{5}
	& \vect{x}_i^{*} 
	&& =  \vect{x}_i^{t-\Delta t} + (1-\xi) \Delta t  \cdot  \dot{\vect{x}}_i^{t-\Delta t / 2}
	\\[0.5em]
	& {\theta}_i^{*} 
	&& =  {\theta}_i^{t-\Delta t} + (1-\xi) \Delta t  \cdot  \dot{{\theta}}_i^{t-\Delta t / 2}
\end{alignat}
\end{subequations}
These equations can be advantageously rewritten to minimize memory allocation by avoiding the storage of the position and the speed of the system at time $t-\Delta t / 2$~:
\begin{subequations}
\label{eq:InterpX2}
\begin{alignat}{5}
	& \vect{x}_i^{*} 
	&& =  \vect{x}_i^{t} -\xi   \Delta t  \cdot \dot{\vect{x}}_i^{t-\Delta t / 2} 
	&& =  \vect{x}_i^{t} -\xi   \Delta t  \cdot (\dot{\vect{x}}_i^{t+\Delta t / 2} - {\Delta t} \cdot \frac{\vect{R}_i^{x,\,t}}{m_i^x} )
	\\[0.5em]
	& {\theta}_i^{*} 
	&& =  {\theta}_i^{t} -\xi \Delta t \cdot \dot{{\theta}}_i^{t-\Delta t / 2} 
	&& =  {\theta}_i^{t} -\xi \Delta t \cdot (\dot{{\theta}}_i^{t+\Delta t / 2} - {\Delta t}  \cdot \frac{R_i^{\theta,\,t}}{m_i^{\theta}})
\end{alignat}
\end{subequations}
This damping is used in combination with the parabolic interpolation introduced by \citef{Barnes1999}. The advantage of this technique is double~:
\begin{itemize}
\item The damping occurs at the interpolated position, that is for a higher level of kinetic energy. Hence, more kinetic energy is dissipated which should improve the convergence speed.
\item Because of the interpolation, the system is less subject to \emph{time step locking} when the system moves back and forth between two positions.
\end{itemize}


\subsection{Stability}

\subsubsection{Fictitious mass}

\subsection{Convergence}
\begin{itemize}
\item relative kinetic energy
\item absolute kinetic energy
\item residual at nodes (force, velocity)
\end{itemize}

%
%The dynamic relaxation method first appeared in the 1960s with Day16 and Otter.17 The goal of this method is to find a static equilibrium. To do so, starting from a given configuration with zero speed, a fictitious dynamic is sim- ulated, where the system under study is immobilized each time it reaches a maximum of kinetic energy and is then released again with zero speed. By immobilizing the sys- tem, the kinetic energy of the system is dissipated. We then simulate a dynamic with “kinetic” damping. For a conservative system, the maximum of kinetic
%energy is a minimum of potential energy, so that when we reach a kinetic energy peak on a trajectory, it is the local minimum of potential energy on this trajectory. Immobilizing the system at kinetic energy peaks is therefore an efficient way to converge toward the static equilibrium, defined as the minimum of potential energy. This is why the kinetic damping is chosen for this damped dynamic. An example of such a fictitious dynamic is illustrated in Figure 3, where we look for the static equilibrium of a ball in an ellipsoidal bowl. In this example, the ball is stopped and released with zero speed each time it reaches a maxi- mum speed.
%Let us now explicit the algorithm of the dynamic relax- ation method for a system with N nodes xxt
%t
%,,⋅ 01
%N
%− , with
%Mi as the mass affected to the node xi
%t . The time interval
%is denoted by ∆t .
%Algorithm






Dynamic relaxation~:
\cite{Lewis2003}
En particulier, voir pour un comparatif avec une méthode implicite.

\IncMargin{2em}
\begin{figure}[p]
\begin{fullpage}
\begin{algorithm}[H]
\SetKwInOut{Input}{input}
\SetKwInOut{Output}{output}
\SetKwProg{Fn}{Function}{:}{}
\SetKwFunction{Solve}{Solve}
\SetKwFunction{Init}{Init}
\SetKwFunction{Run}{Run}
\SetKwFunction{Move}{Move}
\SetKwFunction{CalculateF}{CalcInternalForces}
\SetKwFunction{CalculateM}{CalcInternalMoments}
\SetKwFunction{CalculateA}{CalcAcceleration}
\SetKwFunction{CalculateV}{CalcVelocity}
\SetKwFunction{CalculateE}{CalcKEnergy}
\SetKwFunction{SumFM}{AggregateForcesAndMoments}
\SetKwFunction{SyncFM}{SynchronizeForcesAndMoments}
\SetKwFunction{SumM}{AggregateMasses}
\SetKwFunction{SyncM}{SynchronizeMasses}
\SetKwFunction{InterpX}{InterpolatePosition}
\SetKwFunction{InterpR}{InterpolatePosition}
\SetKwFunction{Reset}{Reset}

\SetKwData{Model}{model}
\SetKwData{Node}{node}
\SetKwData{Joint}{joint}
\SetKwData{Element}{element}
\SetKwData{CVG}{cvg}
\SetKwData{MAX}{maxIteration}

%\Input{A model to analyzed}
%\Output{An analyzed model}

% SOLVE
\Fn{\Solve{\Model, \CVG, \MAX}}{
\BlankLine
\Init{} \;
\Repeat{convergence criterion reached}{
\Run{}\;
}
}{\KwRet}
\BlankLine\BlankLine

\caption{disjoint decomposition}\label{algo_disjdecomp}
\end{algorithm}
\end{fullpage}
\end{figure}
\DecMargin{2em}

% ======== ALGO RUN


\IncMargin{2em}
\begin{figure}[p]
\begin{fullpage}
\begin{algorithm}[H]
\SetKwInOut{Input}{input}
\SetKwInOut{Output}{output}
\SetKwProg{Fn}{Function}{:}{}
\SetKwFunction{Solve}{Solve}
\SetKwFunction{Init}{Init}
\SetKwFunction{Run}{Run}
\SetKwFunction{Move}{Move}
\SetKwFunction{CalculateF}{CalcInternalForces}
\SetKwFunction{CalculateM}{CalcInternalMoments}
\SetKwFunction{CalculateA}{CalcAcceleration}
\SetKwFunction{CalculateV}{CalcVelocity}
\SetKwFunction{CalculateE}{CalcKEnergy}
\SetKwFunction{SumFM}{AggregateForcesAndMoments}
\SetKwFunction{SyncFM}{SynchronizeForcesAndMoments}
\SetKwFunction{SumM}{AggregateMasses}
\SetKwFunction{SyncM}{SynchronizeMasses}
\SetKwFunction{InterpX}{InterpolatePosition}
\SetKwFunction{InterpR}{InterpolatePosition}
\SetKwFunction{Reset}{Reset}

\SetKwData{Model}{model}
\SetKwData{Node}{node}
\SetKwData{Joint}{joint}
\SetKwData{Element}{element}
\SetKwData{CVG}{cvg}
\SetKwData{MAX}{maxIteration}

%\Input{A model to analyzed}
%\Output{An analyzed model}

% RUN
\Fn{\Run{}}{
\BlankLine
\ForEach(\tcc*[f]{$\vect{dx} = \vect{v_x}  dt$, $\vect{d\theta} = \vect{v_{\theta}}  dt$}){\Node in \Model}{
	\Move{$\vect{dx}, \vect{d\theta}$} \;
}
\BlankLine
\tcc{Elements calculate internal forces and moments}
\ForEach(){\Element in \Model}{
\CalculateF{$\vect{x}, \vect{d}_1,  \vect{d}_2,  \vect{d}_3$}
\tcc*[r]{$\vect{F}^{int}(\vect{x}, \vect{d}_1,  \vect{d}_2,  \vect{d}_3)$}

\CalculateM{$\vect{x}, \vect{d}_1,  \vect{d}_2,  \vect{d}_3$}
\tcc*[r]{$\vect{M}^{int}(\vect{x}, \vect{d}_1,  \vect{d}_2,  \vect{d}_3)$}
}
\BlankLine
\tcc{Joints coordinate the dynamic of several nodes}
\ForEach(){\Joint in \Model}{
\SumFM{} \;
\SumM{} \;
\SyncFM{} \;
\SyncM{} \;
}
\BlankLine
\tcc{Calculate translational kinetic energy}
\ForEach(){\Node in \Model}{
	\CalculateA{$m_x, \vect{F}$}
	\tcc*[f]{$\vect{a_x}(t) = \vect{R_x}/m_x$}
	
	\CalculateV{$\vect{a_x}, dt$}
	\tcc*[f]{$\vect{v_x}(t+\tfrac{dt}{2}) = \vect{v_x}(t-\tfrac{dt}{2}) + dt \vect{a_x}(t)$}
	
	\CalculateE{$\vect{v_x}$}
	\tcc*[f]{$E_x(t+\tfrac{dt}{2}) =  \tfrac{1}{2}\sum m_x \vect{v_x}^2(t+\tfrac{dt}{2})$}
}
\BlankLine
\tcc{Detect pic of kinetic energy}
\If{$E_x(t+\tfrac{dt}{2}) < E_x(t-\tfrac{dt}{2})$}{
	\InterpX{} \;
	\Reset{} \;
}

\BlankLine
\tcc{Calculate rotational kinetic energy}
\ForEach(){\Node in \Model}{
	\CalculateA{$m_{\theta}, \vect{M}$}
	\tcc*[f]{$\vect{a_{\theta}}(t) = \vect{R_x}/m_{\theta}$}
	
	\CalculateV{$\vect{a_{\theta}}, dt$}
	\tcc*[f]{$\vect{v_{\theta}}(t+\tfrac{dt}{2}) = \vect{v_{\theta}}(t-\tfrac{dt}{2}) + dt \vect{a_{\theta}}(t)$}
	
	\CalculateE{$\vect{v_{\theta}}$}
	\tcc*[f]{$E_{\theta} = \tfrac{1}{2}\sum m \vect{v_{\theta}}^2(t+\tfrac{dt}{2})$}
}
\BlankLine
\tcc{Detect pic of kinetic energy}
\If{$E_{\theta}(t+\tfrac{dt}{2})  < E_{\theta}(t-\tfrac{dt}{2})$}{
	\InterpR{} \;
	\Reset{} \;
}

}{\KwRet}

\caption{disjoint decomposition}\label{algo_disjdecomp}
\end{algorithm}
\end{fullpage}
\end{figure}
\DecMargin{2em}


\section{Support Reaction}

\section{Marsupilami}
détails et conseils d'implementation
Optimisation : parallélisation / chebfun calcul polynomial
POO : modèle objet
Evènement vs procédural
C\#
Parler de perfview. Peut-être sortir un résulat. 
Parler de serialization
Donner guide lines and recommendations.
Modularité : evaluation courbure, schéma d'intégration, autorefine, autobreak, plasticity
Design pattern

Events-driven vs asynchronous vs parallel.

\blockquote{The events-driven paradigm means that an object called an "event" is sent to the program whenever something happens, without that "something" having to be polled in regular intervals to discover whether it has happened. That "event" may be trapped by the program to perform some actions (i.e. a "handler") -- either synchronous or asynchronous. 

Therefore, handling of events can either be synchronous or asynchronous. JavaScript, for example, uses a synchronous eventing system.

Asynchronous means that actions can happen independent of the current "main" execution stream. Mind you, it does NOT mean "parallel", or "different thread". An "asynchronous" action may actually run on the main thread, blocking the "main" execution stream in the meantime. So don't confuse "asynchronous" with "multi-threading".

You may say that, technically speaking, an asynchronous operation automatically assumes eventing -- at least "completed", "faulted" or "aborted/cancelled" events (one or more of these) are sent to the instigator of the operation (or the underlying O/S itself) to signal that the operation has ceased. Thus, async is always event-driven, but not the other way round.
}

\clearpage

\section{Conclusion}
Remind that the beam is subject to a distributed external force $\vect{f}_{ext}$ and a distributed external moment $\vect{m}_{ext}$.

We neglect rotational inertial effects on $\vect{d}_1$ et $\vect{d}_2$ in \eqref{eq:3_16_b} and \eqref{eq:3_16_c} which leads to the following shear force~:
\begin{equation}
	\vect{F}^{\perp}(s) = \vect{d}_3 \times (\vect{M}' + \vect{\varkappa} \times \vect{M} + \vect{m}_{ext})
\end{equation}
\begin{equation}
	\vect{F}^{\parallel}(s) = N \vect{d}_3
\end{equation}
\note{We may neglect as well the last term ($\tau \vect{M}$) and get back to the shear force obtained by the variational approach.} The total internal force acting on the beam is hence given by~:
\begin{equation}
	\vect{F}(s) = \vect{N}(s) + \vect{T}(s)
\end{equation}
Sections are subject to the following rotational moment around the centerline~:
\begin{equation}
	\begin{aligned}
	\vect{\Gamma}(s) = Q' + \vect{d}_3 \cdot ( \kappa\vect{b} \times \mat{M} + \vect{m}_{ext})
	\end{aligned}
\end{equation}

